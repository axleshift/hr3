import{r,R as z,j as e,C as E}from"./index-DH84xEMy.js";import{a as p}from"./api-b5EB9aEo.js";import{b as $,F as j,x as q,a as G,q as V,z as J,H as K}from"./index-CWfMdjxT.js";import{C as O,a as f,b as g,c as C}from"./CToaster-Buc9HUBZ.js";import{C as Q,a as U}from"./CCardBody-BiYWHczo.js";import{C as W}from"./CCardHeader-BKJnbTPA.js";import{C as X}from"./CFormSelect-DkN-l4Zl.js";import{C as Z}from"./CInputGroup-B-o5lMH9.js";import{C as ee}from"./CInputGroupText-C2R2qtBm.js";import{C as se}from"./CFormInput-BNOGNQbV.js";import{C as te}from"./CAlert-c1ydVGHq.js";import{C as ae,a as re,b as F,c as d,d as ne,e as u}from"./CTable-Cch85I5J.js";import{a as le,b as oe,c as ce,d as ie,e as P}from"./DefaultLayout-BTe0L-jU.js";import"./index-xsH4HHeE.js";import"./CFormControlWrapper-tX4rBDMg.js";const Ee=()=>{const[N,D]=r.useState([]),[y,w]=r.useState([]),[S,m]=r.useState(!1),[b,h]=r.useState(null),[l,I]=r.useState(new Date().getMonth()+1),[n,de]=r.useState(new Date().getFullYear()),[v,B]=r.useState(new Date().toLocaleString("default",{month:"long"})),[L,c]=r.useState(0),M=z.useRef(),[o,_]=r.useState({search:"",department:"all",status:"all"}),[ue,A]=r.useState([]),[me,he]=r.useState(!1),x=async()=>{try{m(!0),h(null);const s=await p.get("/payslips",{params:{year:n,month:l}});D(s.data);const t=s.data.filter(i=>i.month==l&&i.year==n);w(t);const a=[...new Set(t.map(i=>i.department))];A(a)}catch(s){console.error("Error fetching payslips:",s),h("Failed to fetch payslips"),D([]),w([])}finally{m(!1)}};r.useEffect(()=>{x()},[n,l]),r.useEffect(()=>{const s=new Date(n,l-1).toLocaleString("default",{month:"long"});B(s)},[l,n]),r.useEffect(()=>{let s=[...N];if(s=s.filter(t=>t.month==l&&t.year==n),o.search){const t=o.search.toLowerCase();s=s.filter(a=>a.name.toLowerCase().includes(t)||a.employee_id.toString().includes(t))}o.department!=="all"&&(s=s.filter(t=>t.department===o.department)),o.status!=="all"&&(s=s.filter(t=>(t.status||"Pending").toLowerCase()===o.status.toLowerCase())),w(s)},[o,N,l,n]);const H=async()=>{var s,t;try{m(!0);const a=await p.post("/payslip/release",{month:l,year:n});c(e.jsxs(f,{title:"Success",color:"success",children:[e.jsx(g,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Success"})}),e.jsx(C,{children:a.data.count>0?`Successfully released ${a.data.count} payslips`:a.data.message})]})),setTimeout(()=>c(0),3e3),await x()}catch(a){console.error("Error releasing payslips:",a),c(e.jsxs(f,{title:"Error",color:"danger",children:[e.jsx(g,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Error"})}),e.jsx(C,{children:((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to release payslips"})]})),setTimeout(()=>c(0),3e3)}finally{m(!1)}},R=async s=>{var t,a;try{m(!0);const i=await p.post(`/payslips/send/${s}`);c(e.jsxs(f,{title:"Success",color:"success",children:[e.jsx(g,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Success"})}),e.jsx(C,{children:"Payslip sent successfully"})]})),setTimeout(()=>c(0),3e3),await x()}catch(i){console.error("Error sending payslip:",i),c(e.jsxs(f,{title:"Error",color:"danger",children:[e.jsx(g,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Error"})}),e.jsx(C,{children:((a=(t=i.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to send payslip"})]})),setTimeout(()=>c(0),3e3)}finally{m(!1)}},T=async(s,t)=>{try{await p.put(`/payslips/${s}`,{status:t}),await x()}catch(a){console.error("Error updating status:",a),h("Failed to update payslip status")}},k=s=>{if(!s)return"Not sent yet";try{const t=new Date(s);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString()}catch{return"Invalid Date"}},Y=s=>{switch((s||"pending").toLowerCase()){case"pending":return"warning";case"paid":return"success";case"sent":case"generated":return"primary";default:return"secondary"}};return Array.from({length:new Date().getFullYear()-2020+1},(s,t)=>2020+t),e.jsxs($,{fluid:!0,children:[e.jsx(O,{ref:M,push:L,placement:"top-end"}),e.jsxs(Q,{children:[e.jsxs(W,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Payslip Management"}),e.jsxs("div",{className:"small text-muted",children:[v," ",n]})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx(X,{value:l,onChange:s=>I(Number(s.target.value)),style:{width:"120px"},children:Array.from({length:12},(s,t)=>e.jsx("option",{value:t+1,children:new Date(2023,t).toLocaleString("default",{month:"long"})},t+1))}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(j,{icon:q})}),e.jsx(se,{placeholder:"Search by name or ID",value:o.search,onChange:s=>_({...o,search:s.target.value})})]}),e.jsx(G,{color:"primary",onClick:H,disabled:S,children:S?e.jsx(E,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:V,className:"me-2"}),"Release Payslips"]})})]})]}),e.jsxs(U,{children:[b&&e.jsx(te,{color:"danger",dismissible:!0,onClose:()=>h(null),children:b}),S&&y.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsx(E,{color:"primary"})}):y.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsxs("p",{children:["No payslips found for ",v," ",n]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs(ae,{hover:!0,responsive:!0,children:[e.jsx(re,{children:e.jsxs(F,{children:[e.jsx(d,{children:"#"}),e.jsx(d,{children:"Employee"}),e.jsx(d,{children:"Department"}),e.jsx(d,{children:"Position"}),e.jsx(d,{children:"Net Salary"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Issued At"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(ne,{children:y.map((s,t)=>e.jsxs(F,{children:[e.jsx(u,{children:t+1}),e.jsxs(u,{children:[e.jsx("div",{children:s.name}),e.jsxs("small",{className:"text-muted",children:["ID: ",s.employee_id]})]}),e.jsx(u,{children:s.department}),e.jsx(u,{children:s.job_position}),e.jsx(u,{children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s.net_salary||0)}),e.jsx(u,{children:e.jsx(le,{color:Y(s.status),children:s.status||"Pending"})}),e.jsx(u,{children:k(s.issued_at)}),e.jsx(u,{children:e.jsxs(oe,{children:[e.jsx(ce,{color:"secondary",size:"sm",children:e.jsx(j,{icon:J})}),e.jsxs(ie,{children:[e.jsxs(P,{onClick:()=>R(s.id),disabled:!s.id,children:[e.jsx(j,{icon:K,className:"me-2"}),"Send Email"]}),e.jsx(P,{onClick:()=>T(s.id,"Paid"),disabled:s.status==="Paid",children:"Mark as Paid"}),e.jsx(P,{onClick:()=>T(s.id,"Pending"),disabled:s.status==="Pending",children:"Mark as Pending"})]})]})})]},s.employee_id))})]})})]})]})]})};export{Ee as default};
