import{r as a,m as C,j as e,C as se}from"./index-BxPMRiOx.js";import{a as h,F as ae,G as te}from"./index-CHxR6kfz.js";import{C as re,a as ne}from"./CCardBody-Bf6m39uI.js";import{C as le}from"./CCardHeader-DxspMELc.js";import{C as H}from"./CAlert-BGRo5KpD.js";import{C as ie,a as oe,b,c as d,d as ce,e as c}from"./CTable-C17j_Ha9.js";import{C as I}from"./DefaultLayout-CvhdctoF.js";import{C as U,a as V,b as O,c as G}from"./CModalTitle-DbS9uuA_.js";import{C as de}from"./CForm-CUd9nFA4.js";import{C as ue}from"./CFormSelect-7ZmGWLhT.js";import{C as pe,a as $}from"./CRow-D1Z1Hc-r.js";import{C as y}from"./CFormInput-2_R57NfV.js";import{C as me}from"./CFormTextarea-DOQpZc1S.js";import{C as z}from"./CModalFooter-ClZ5wmTh.js";import"./CFormControlWrapper-avtW3fxm.js";const Ne=()=>{const[D,J]=a.useState([]),[K,j]=a.useState(!0),[S,T]=a.useState(null),[Q,L]=a.useState(!1),[g,q]=a.useState(""),[u,F]=a.useState(""),[p,N]=a.useState(""),[f,R]=a.useState(""),[w,E]=a.useState(null),[n,_]=a.useState({}),[r,m]=a.useState({visible:!1,type:"",message:""}),[i,v]=a.useState(null),[W,X]=a.useState([]),o=sessionStorage.getItem("user_id");a.useEffect(()=>{if(r.visible){const s=setTimeout(()=>m({...r,visible:!1}),3e3);return()=>clearTimeout(s)}},[r]),a.useEffect(()=>{if(!o){T("User ID not found. Please log in again."),j(!1);return}M(),Y()},[o]);const M=a.useCallback(async()=>{try{j(!0);const s=await C.get(`/api/leave/${o}`);J(s.data.leaveRequests||[])}catch{T("Failed to load leave requests. Please try again later.")}finally{j(!1)}},[o]),Y=a.useCallback(async()=>{try{const s=await C.get("/api/leave-types");X(s.data)}catch(s){console.error("Error fetching leave types:",s)}},[]),k=s=>{switch(s){case"Pending":return"warning";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},Z=s=>{const t=s.target.files[0];t&&E(t)},ee=async s=>{var B,P,A;if(s.preventDefault(),!o||isNaN(o)){m({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}const t={};if(g.trim()||(t.leaveType="Leave Type is required"),u.trim()||(t.startDate="Start Date is required"),p.trim()?new Date(u)>new Date(p)&&(t.endDate="End Date must be after Start Date"):t.endDate="End Date is required",f.trim()||(t.reason="Reason is required"),Object.keys(t).length>0){_(t);return}_({});const l=new FormData;l.append("user_id",o),l.append("name",sessionStorage.getItem("name")||""),l.append("leave_type",g),l.append("start_date",u),l.append("end_date",p),l.append("reason",f),w&&l.append("document",w);try{const x=await C.post("/api/leave-requests",l,{headers:{"Content-Type":"multipart/form-data"}});m({visible:!0,type:"success",message:"Leave request submitted successfully!"}),q(""),F(""),N(""),R(""),E(null),M()}catch(x){console.error("Error Response:",(B=x.response)==null?void 0:B.data),m({visible:!0,type:"danger",message:(A=(P=x.response)==null?void 0:P.data)!=null&&A.errors?Object.values(x.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return e.jsxs(re,{children:[e.jsxs(le,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"My Leave Requests"}),e.jsx(h,{className:"float-end",color:"primary",onClick:()=>L(!0),children:"Request Leave"})]}),e.jsx(ne,{children:K?e.jsxs("div",{className:"text-center",children:[e.jsx(se,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):S?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:S})}):e.jsxs(e.Fragment,{children:[r.visible&&e.jsx(H,{color:r.type,dismissible:!0,children:r.message}),e.jsxs(ie,{hover:!0,responsive:!0,children:[e.jsx(oe,{children:e.jsxs(b,{className:"text-center",children:[e.jsx(d,{children:"#"}),e.jsx(d,{children:"Leave Type"}),e.jsx(d,{children:"Date Requested"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(ce,{className:"text-center",children:D.length===0?e.jsx(b,{children:e.jsx(c,{colSpan:"5",className:"text-center",children:"No leave requests available."})}):D.map((s,t)=>e.jsxs(b,{children:[e.jsx(c,{children:t+1}),e.jsx(c,{children:s.leave_type}),e.jsx(c,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(c,{children:e.jsx(I,{color:k(s.status),children:s.status})}),e.jsx(c,{children:e.jsx(h,{color:"info",component:"span",onClick:()=>v(s),children:e.jsx(ae,{icon:te})})})]},s.id))})]})]})}),e.jsxs(U,{visible:Q,onClose:()=>L(!1),children:[e.jsx(V,{children:e.jsx(O,{children:"Leave Request"})}),e.jsxs(G,{children:[r.visible&&e.jsx(H,{color:r.type,dismissible:!0,children:r.message}),e.jsxs(de,{onSubmit:ee,id:"leaveForm",children:[e.jsxs(ue,{label:"Leave Type",value:g,onChange:s=>q(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),W.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),n.leaveType&&e.jsx("span",{className:"text-danger",children:n.leaveType}),e.jsx("br",{}),e.jsxs(pe,{children:[e.jsxs($,{className:"mb-3",children:[e.jsx(y,{type:"date",label:"Start Date",value:u,onChange:s=>F(s.target.value),required:!0}),n.startDate&&e.jsx("span",{className:"text-danger",children:n.startDate})]}),e.jsxs($,{className:"mb-3",children:[e.jsx(y,{type:"date",label:"End Date",value:p,onChange:s=>N(s.target.value),required:!0}),n.endDate&&e.jsx("span",{className:"text-danger",children:n.endDate})]})]}),e.jsx(me,{label:"Reason",value:f,onChange:s=>R(s.target.value),required:!0}),n.reason&&e.jsx("span",{className:"text-danger",children:n.reason}),e.jsx("br",{}),e.jsx(y,{type:"file",label:"Upload Document",onChange:Z,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg"}),e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Notice:"})," Please combine multiple files or images into a single PDF before uploading."]}),e.jsx("br",{}),e.jsx("br",{})]})]}),e.jsx(z,{children:e.jsx(h,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]}),e.jsxs(U,{visible:!!i,onClose:()=>v(null),children:[e.jsx(V,{children:e.jsx(O,{children:"Leave Details"})}),e.jsx(G,{children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Leave Type:"})," ",i.leave_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",i.reason]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Requested:"})," ",new Date(i.created_at).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(I,{color:k(i.status),children:i.status})]})]})}),e.jsx(z,{children:e.jsx(h,{color:"secondary",onClick:()=>v(null),children:"Close"})})]})]})};export{Ne as default};
