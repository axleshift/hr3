import{r as a,j as e,C as A}from"./index-DXiirQRx.js";import{a as T}from"./api-o2G9ZHTO.js";import{C as H,a as P}from"./CCardBody-BUhW-l3R.js";import{C as V}from"./CCardHeader-BnPxTvfx.js";import{a as R}from"./index-Cg_UBKJG.js";import{C as k,a as O,b as h,c as r,d as $,e as t}from"./CTable-B7cNnFp6.js";import{C as z}from"./DefaultLayout-BYzA4Qo5.js";import{C as G,a as J,b as K,c as Q,d as U}from"./CModalTitle-DIZXrOAx.js";import{a as W,C as X}from"./CForm-DyhVacUX.js";import{C as Y}from"./CFormSelect-DTDeymM8.js";import{C as Z,a as _}from"./CRow-C69E6MCS.js";import{C as F}from"./CFormInput-HYtjY2kQ.js";import{C as ee}from"./CFormTextarea-BHA_IKrX.js";import"./index-OZHYTCeR.js";const he=()=>{const[j,w]=a.useState([]),[M,v]=a.useState(!0),[C,y]=a.useState(null),[N,c]=a.useState(!1),[u,g]=a.useState(""),[o,f]=a.useState(""),[n,b]=a.useState(""),[m,S]=a.useState(""),[p,i]=a.useState({visible:!1,type:"",message:""}),x=sessionStorage.getItem("employee_id"),L={employee_id:sessionStorage.getItem("employee_id")||"",name:sessionStorage.getItem("name")||""};a.useEffect(()=>{if(!x){y("Employee ID not found. Please log in again."),v(!1);return}q()},[x]);const q=async()=>{try{const s=await T.get(`/leave-requests/${x}`);w(s.data.leaveRequests)}catch(s){console.error("Error fetching leave list:",s),y("Failed to load leave requests. Please try again later.")}finally{v(!1)}},B=s=>{switch(s){case"Pending":return"primary";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},I=async s=>{var d,D,E;if(s.preventDefault(),!u||!o||!n||!m){i({visible:!0,type:"danger",message:"All fields are required."});return}if(new Date(o)>new Date(n)){i({visible:!0,type:"danger",message:"End Date must be after Start Date."});return}try{const l=await T.post("/leave-request",{employee_id:L.employee_id,name:L.name,leave_type:u,start_date:o,end_date:n,reason:m,status:"Pending"});console.log("Response:",l.data),i({visible:!0,type:"success",message:"Leave request submitted successfully!"}),g(""),f(""),b(""),S(""),q(),setTimeout(()=>{c(!1)},2e3)}catch(l){console.error("Error Response:",(d=l.response)==null?void 0:d.data),i({visible:!0,type:"danger",message:(E=(D=l.response)==null?void 0:D.data)!=null&&E.errors?Object.values(l.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return e.jsxs(H,{children:[e.jsxs(V,{children:[e.jsx("strong",{children:"My Leave Requests"}),e.jsx(R,{className:"float-end",color:"primary",onClick:()=>c(!0),children:"Request"})]}),e.jsx(P,{children:M?e.jsxs("div",{className:"text-center",children:[e.jsx(A,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):C?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:C})}):e.jsxs(k,{hover:!0,responsive:!0,children:[e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(r,{children:"#"}),e.jsx(r,{children:"Leave Type"}),e.jsx(r,{children:"Start Date"}),e.jsx(r,{children:"End Date"}),e.jsx(r,{children:"Days"}),e.jsx(r,{children:"Status"})]})}),e.jsx($,{children:j.length===0?e.jsx(h,{children:e.jsx(t,{colSpan:"6",className:"text-center",children:"No leave requests available."})}):j.map((s,d)=>e.jsxs(h,{children:[e.jsx(t,{children:d+1}),e.jsx(t,{children:s.leave_type}),e.jsx(t,{children:s.start_date}),e.jsx(t,{children:s.end_date}),e.jsx(t,{children:s.total_days}),e.jsx(t,{children:e.jsx(z,{color:B(s.status),children:s.status})})]},s.id))})]})}),e.jsxs(G,{visible:N,onClose:()=>c(!1),children:[e.jsx(J,{children:e.jsx(K,{children:"Leave Request"})}),e.jsxs(Q,{children:[p.visible&&e.jsx(W,{color:p.type,dismissible:!0,children:p.message}),e.jsxs(X,{onSubmit:I,id:"leaveForm",children:[e.jsxs(Y,{label:"Leave Type",value:u,onChange:s=>g(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation Leave",children:"Vacation Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"})]}),e.jsx("br",{}),e.jsxs(Z,{children:[e.jsx(_,{className:"mb-3",children:e.jsx(F,{type:"date",label:"Start Date",value:o,onChange:s=>f(s.target.value),required:!0})}),e.jsx(_,{className:"mb-3",children:e.jsx(F,{type:"date",label:"End Date",value:n,onChange:s=>b(s.target.value),required:!0})})]}),e.jsx(ee,{label:"Reason",value:m,onChange:s=>S(s.target.value),required:!0}),e.jsx("br",{})]})]}),e.jsx(U,{children:e.jsx(R,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]})]})};export{he as default};
