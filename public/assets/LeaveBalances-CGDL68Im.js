import{r,_ as le,a as C,R as T,c as ie,P as o,e as ce,y as de,j as e,C as ee}from"./index-BE17hZRv.js";import{a as ae}from"./api-b5EB9aEo.js";import{i as te,u as me,f as ue,C as fe,a as pe}from"./DefaultLayout-CWbSx2tv.js";import{C as he,a as ye,b as ve,c as ge}from"./CToaster-BrItzVMg.js";import{C as xe,a as Ce}from"./CCardBody-D77FAhOK.js";import{C as je}from"./CCardHeader-CWsWfkQB.js";import{u as be,a as G}from"./index-DZu0FN0C.js";import{c as Ne}from"./cil-plus-D8mtC-W5.js";import{C as V,a as B}from"./CRow-CrtATQ_P.js";import{C as Te,a as we,b as se,c as k,d as _e,e as S}from"./CTable-D32VYvW9.js";import{C as Pe,a as J}from"./CPaginationItem-DTEiD91U.js";import{C as Ee,a as ke,b as Se,c as De}from"./CModalTitle-QwMdlv-s.js";import{C as Re}from"./CForm-DnTuMTJV.js";import{C as K}from"./CFormControlWrapper-BidSriqe.js";import{C as re}from"./CFormInput-P61gnO9f.js";import{C as Fe}from"./CFormSelect-CxYPkiR7.js";import{C as Le}from"./CFormCheck-C3pEsGjs.js";import{C as Be}from"./CModalFooter-BybXRAQu.js";import"./index-xsH4HHeE.js";var Ie=function(t){if(!t)return 0;var n=window.getComputedStyle(t),c=n.transitionDuration,u=n.transitionDelay,h=Number.parseFloat(c),d=Number.parseFloat(u);return!h&&!d?0:(c=c.split(",")[0],u=u.split(",")[0],(Number.parseFloat(c)+Number.parseFloat(u))*1e3)},ne=function(t){typeof t=="function"&&t()},Me=function(t){t.dispatchEvent(new Event("transitionend"))},Ae=function(t,n,c){if(c===void 0&&(c=!0),!c){ne(t);return}var u=5,h=Ie(n)+u,d=!1,w=function(v){var _=v.target;_===n&&(d=!0,n.removeEventListener("transitionend",w),ne(t))};n.addEventListener("transitionend",w),setTimeout(function(){d||Me(n)},h)},He=function(t,n){switch(t){case"right":return te(n)?"left":"right";case"left":return te(n)?"right":"left";default:return t}},Q=r.forwardRef(function(t,n){var c=t.children,u=t.animation,h=u===void 0?!0:u,d=t.className,w=t.container,v=t.content,_=t.delay,j=_===void 0?0:_,Y=t.fallbackPlacements,W=Y===void 0?["top","right","bottom","left"]:Y,l=t.offset,$=l===void 0?[0,6]:l,I=t.onHide,M=t.onShow,D=t.placement,z=D===void 0?"top":D,R=t.popperConfig,A=t.trigger,m=A===void 0?["hover","focus"]:A,P=t.visible,f=le(t,["children","animation","className","container","content","delay","fallbackPlacements","offset","onHide","onShow","placement","popperConfig","trigger","visible"]),g=r.useRef(null),p=r.useRef(null),U=be(n,g),b="tooltip".concat(r.useId()),F=r.useState(!1),x=F[0],H=F[1],N=r.useState(P),a=N[0],s=N[1],i=me(),E=i.initPopper,y=i.destroyPopper,L=i.updatePopper,X=typeof j=="number"?{show:j,hide:j}:j,Z={modifiers:[{name:"arrow",options:{element:".tooltip-arrow"}},{name:"flip",options:{fallbackPlacements:W}},{name:"offset",options:{offset:$}}],placement:He(z,p.current)},oe=C(C({},Z),typeof R=="function"?R(Z):R);r.useEffect(function(){if(P){q();return}O()},[P]),r.useEffect(function(){if(x&&p.current&&g.current){E(p.current,g.current,oe),setTimeout(function(){s(!0)},X.show);return}!x&&p.current&&g.current&&y()},[x]),r.useEffect(function(){!a&&p.current&&g.current&&Ae(function(){H(!1)},g.current)},[a]);var q=function(){H(!0),M&&M()},O=function(){setTimeout(function(){s(!1),I&&I()},X.hide)};return r.useEffect(function(){L()},[v]),T.createElement(T.Fragment,null,T.cloneElement(c,C(C(C(C(C({},a&&{"aria-describedby":b}),{ref:p}),(m==="click"||m.includes("click"))&&{onClick:function(){return a?O():q()}}),(m==="focus"||m.includes("focus"))&&{onFocus:function(){return q()},onBlur:function(){return O()}}),(m==="hover"||m.includes("hover"))&&{onMouseEnter:function(){return q()},onMouseLeave:function(){return O()}})),T.createElement(ue,{container:w,portal:!0},x&&T.createElement("div",C({className:ie("tooltip","bs-tooltip-auto",{fade:h,show:a},d),id:b,ref:U,role:"tooltip"},f),T.createElement("div",{className:"tooltip-arrow"}),T.createElement("div",{className:"tooltip-inner"},v))))});Q.propTypes={animation:o.bool,children:o.node,container:o.any,content:o.oneOfType([o.string,o.node]),delay:o.oneOfType([o.number,o.shape({show:o.number.isRequired,hide:o.number.isRequired})]),fallbackPlacements:de,offset:o.any,onHide:o.func,onShow:o.func,placement:o.oneOf(["auto","top","right","bottom","left"]),popperConfig:o.oneOfType([o.func,o.object]),trigger:ce,visible:o.bool};Q.displayName="CTooltip";const na=()=>{const n=new Date().getFullYear(),[c,u]=r.useState([]),[h,d]=r.useState(!0),[w,v]=r.useState(!1),[_,j]=r.useState([]),[Y,W]=r.useState(null),[l,$]=r.useState({employeeId:"",year:n,page:1,per_page:10}),[I,M]=r.useState(0),[D,z]=r.useState([]),[R,A]=r.useState([]),[m,P]=r.useState({days:15,year:n,employeeIds:[],convert_to_earnings:!0,conversion_rate:100}),f=(a,s)=>{const i=Date.now(),E=e.jsxs(ye,{autohide:!0,delay:5e3,color:s,visible:!0,children:[e.jsx(ve,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(ge,{children:a})]},i);j(y=>[...y,E]),setTimeout(()=>{j(y=>y.filter(L=>L.key!==i.toString()))},5e3)};r.useEffect(()=>{F(),g()},[l]);const g=async()=>{try{d(!0);const a=await fetch("https://backend-hr1.axleshift.com/api/employees");if(!a.ok)throw new Error("Failed to fetch employees");const s=await a.json();A(s.data||s),f("Employee data loaded successfully","success")}catch(a){console.error("Error fetching employees:",a),f("Failed to load employee data","danger")}finally{d(!1)}},p=()=>{v(!1),P({days:15,year:n,employeeIds:[],convert_to_earnings:!0,conversion_rate:100}),z([])},U=async()=>{var a,s;try{d(!0);const i={...m,employeeIds:D.length>0?D:R.map(y=>y.employeeId)};if(i.employeeIds.length===0){f("Please select at least one employee","warning");return}const E=await ae.post("/leave-balances",i);F(),v(!1),f("Leave days allocated successfully!","success"),p()}catch(i){console.error("Error allocating leave:",i),f(((s=(a=i.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to allocate leave days. Please try again.","danger")}finally{d(!1)}},b=a=>{const{name:s,value:i,type:E,checked:y}=a.target;P(L=>({...L,[s]:E==="checkbox"?y:i}))},F=async()=>{try{d(!0);const a={year:n,employeeId:l.employeeId,page:l.page,per_page:l.per_page},s=await ae.get("/leave-balances",{params:a});u(s.data.data||s.data),M(s.data.total||s.data.length),f("Leave balances loaded successfully","success")}catch(a){console.error("Error fetching leave balances:",a),f("Failed to load leave balances. Please try again.","danger")}finally{d(!1)}},x=a=>{$(s=>({...s,page:a})),f(`Viewing page ${a} of ${N}`,"info")},H=Array.from({length:5},(a,s)=>n-2+s),N=Math.ceil(I/l.per_page);return e.jsxs("div",{children:[e.jsx(he,{placement:"top-end",children:_}),h&&e.jsx("div",{className:"loading-overlay",children:e.jsx(ee,{color:"primary",variant:"grow"})}),e.jsxs(xe,{children:[e.jsxs(je,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Employee Leave Balances"}),e.jsxs("small",{className:"text-medium-emphasis",children:["Showing ",l.year," data"]})]}),e.jsx(G,{color:"primary",onClick:()=>v(!0),className:"d-flex align-items-center",children:e.jsx(fe,{icon:Ne,className:"me-2"})})]}),e.jsxs(Ce,{children:[e.jsx(V,{className:"mb-4 g-3"}),c.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("h5",{children:"No leave balances found"}),e.jsx("p",{children:"Try adjusting your filters or allocate leave days to employees"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(Te,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(we,{children:e.jsxs(se,{children:[e.jsx(k,{children:"Employee ID"}),e.jsx(k,{children:"Name"}),e.jsx(k,{className:"text-end",children:"Allocated Days"}),e.jsx(k,{className:"text-end",children:"Used Days"}),e.jsx(k,{className:"text-end",children:"Remaining Days"}),e.jsx(k,{children:"Convertible"})]})}),e.jsx(_e,{children:c.map(a=>e.jsxs(se,{children:[e.jsx(S,{children:a.employeeId}),e.jsx(S,{children:[a.firstName,a.middleName,a.lastName].filter(Boolean).join(" ")}),e.jsx(S,{className:"text-end",children:a.allocated_days}),e.jsx(S,{className:"text-end",children:a.used_days}),e.jsx(S,{className:"text-end",children:e.jsx("strong",{className:a.remaining_days<3?"text-warning":"text-success",children:a.remaining_days})}),e.jsx(S,{children:e.jsx(Q,{content:a.convert_to_earnings?`Unused days will be converted at ${a.conversion_rate}% of daily rate`:"Not convertible to earnings",children:e.jsx(pe,{color:a.convert_to_earnings?"success":"secondary",children:a.convert_to_earnings?"Yes":"No"})})})]},a.id))})]})}),N>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(Pe,{children:[e.jsx(J,{disabled:l.page===1,onClick:()=>x(l.page-1),children:"Previous"}),Array.from({length:N},(a,s)=>s+1).map(a=>e.jsx(J,{active:a===l.page,onClick:()=>x(a),children:a},a)),e.jsx(J,{disabled:l.page===N,onClick:()=>x(l.page+1),children:"Next"})]})})]})]})]}),e.jsxs(Ee,{visible:w,onClose:p,size:"lg",backdrop:"static",children:[e.jsx(ke,{closeButton:!0,children:e.jsx(Se,{children:"Allocate Leave Days"})}),e.jsx(De,{children:e.jsxs(Re,{children:[e.jsxs(V,{className:"mb-3",children:[e.jsxs(B,{md:6,children:[e.jsx(K,{children:"Days to Allocate *"}),e.jsx(re,{type:"number",name:"days",value:m.days,onChange:b,min:"1",placeholder:"Enter number of days",required:!0})]}),e.jsxs(B,{md:6,children:[e.jsx(K,{children:"Year *"}),e.jsx(Fe,{name:"year",value:m.year,onChange:b,required:!0,children:H.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsx(V,{className:"mb-3",children:e.jsx(B,{md:6,className:"d-flex align-items-end",children:e.jsx(Le,{name:"convert_to_earnings",label:"Convert unused leave to earnings",checked:m.convert_to_earnings,onChange:b,className:"mt-3"})})}),m.convert_to_earnings&&e.jsxs(V,{className:"mb-4",children:[e.jsxs(B,{md:6,children:[e.jsx(K,{children:"Conversion Rate (% of daily rate)"}),e.jsx(re,{type:"number",name:"conversion_rate",value:m.conversion_rate,onChange:b,min:"0",max:"100",placeholder:"Enter percentage"})]}),e.jsx(B,{md:6,className:"d-flex align-items-end",children:e.jsx("small",{className:"text-medium-emphasis",children:"Example: 100% means full daily rate per unused leave day"})})]})]})}),e.jsxs(Be,{children:[e.jsx(G,{color:"secondary",onClick:p,children:"Cancel"}),e.jsx(G,{color:"primary",onClick:U,disabled:h,children:h?e.jsx(ee,{size:"sm"}):"Allocate Leave Days"})]})]})]})};export{na as default};
