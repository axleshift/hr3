import{r as t,j as e,C as he,a as c}from"./index-CB7OUzk2.js";import{b as l,F as j,h as xe,i as me,j as je,k as ue,l as pe}from"./Compliance-lCZO8XuK.js";import{C as ge,a as fe}from"./CCardBody-CmvYpM3N.js";import{C as be}from"./CCardHeader-BhOK-01F.js";import{C as E}from"./CFormSelect-D7c-pNlG.js";import{C as ye,a as Ce,b as J,c as o,d as Se,e as n}from"./CTable-CNFJcFgE.js";import{C as Fe,a as ve,b as De,c as Pe,d as Y}from"./DefaultLayout-Ds5OGV6J.js";import{C as f,a as b,b as y,c as C}from"./CModalTitle-Bjlw0HkJ.js";import{C as S}from"./CFormControlWrapper-BnsjPntT.js";import{C as _}from"./CFormInput-CEPgCUNz.js";import{C as B}from"./CModalFooter-CwrRIAph.js";const Ie=()=>{const[M,L]=t.useState([]),[q,u]=t.useState(!0),[d,z]=t.useState(new Date().getMonth()+1),[i,G]=t.useState(new Date().getFullYear()),[N,X]=t.useState(new Date().toLocaleString("default",{month:"long"})),[F,p]=t.useState(!1),[v,k]=t.useState(""),[D,H]=t.useState(!1),[V,T]=t.useState(0),[$,K]=t.useState(!1),[r,Q]=t.useState(null),[U,g]=t.useState(!1),[we,Ee]=t.useState([]),[P,A]=t.useState(""),[w,R]=t.useState(""),[I,h]=t.useState(""),[W,Z]=t.useState([]),[ee,se]=t.useState([]),ae=async()=>{try{const s=await c.get("/api/job-positions");Z(s.data)}catch(s){console.error("Error fetching job positions:",s),setError("Failed to fetch job positions")}},m=async()=>{try{u(!0),setError(null);const s=await c.get("/api/payroll",{params:{year:i,month:d}});L(Array.isArray(s.data)?s.data:[])}catch(s){console.error("Error fetching payroll data:",s),setError("Failed to fetch payroll data"),L([])}finally{u(!1)}},te=async()=>{var s,a;if(!P||!w){h("All fields are required");return}try{await c.post("/api/salaries",{job_position:P,base_salary:parseFloat(w)}),g(!1),h(""),A(""),R(""),m()}catch(x){console.error("Error saving salary:",x),h(((a=(s=x.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to save salary")}};t.useEffect(()=>{ae(),m()},[i,d]),t.useEffect(()=>{X(new Date(i,d-1).toLocaleString("default",{month:"long"}))},[d,i]);const re=async()=>{try{const s=await c.get("/api/rates");k(s.data.overtime_rate||"")}catch(s){console.error("Error fetching rates:",s),h("Failed to fetch overtime rate")}};t.useEffect(()=>{F&&re()},[F]);const oe=async()=>{var s,a;if(!v){h("Overtime rate is required");return}try{await c.post("/api/rates",{overtime_rate:parseFloat(v)}),p(!1),h(""),m()}catch(x){h(((a=(s=x.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to save overtime rate")}},ne=async s=>{try{u(!0),Q(s);const a=await c.get("/api/benefits",{params:{employee_id:s.employee_id,year:i,month:d}});se(a.data),setPayslipModalVisible(!0)}catch(a){console.error("Error fetching benefits:",a),setError("Failed to fetch benefits data")}finally{u(!1)}},O=async(s,a)=>{try{await c.put(`/api/payrolls/${s}`,{status:a}),m()}catch(x){console.error("Error updating status:",x),setError("Failed to update payroll status")}},ie=async()=>{try{await c.post("/api/payroll/bonus",{year:i,month:d,bonus:parseFloat(V)}),setBonusModalVisible(!1),m()}catch(s){console.error("Error saving bonus:",s),setError("Failed to save bonus")}},le=async()=>{var s;try{const a=await c.get("/api/payroll/bonus",{params:{year:i,month:d}});T(((s=a.data)==null?void 0:s.bonus)||0)}catch(a){console.error("Error fetching bonus:",a),setError("Failed to fetch bonus data")}};t.useEffect(()=>{D&&le()},[D]);const ce=Array.from({length:new Date().getFullYear()-2020+1},(s,a)=>2020+a),de=s=>{switch((s==null?void 0:s.toLowerCase())||"pending"){case"pending":return"warning";case"paid":return"success";default:return"secondary"}};return e.jsxs("div",{children:[e.jsxs(ge,{children:[e.jsxs(be,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Employee Payroll"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx(E,{value:d,onChange:s=>z(Number(s.target.value)),style:{width:"120px"},children:Array.from({length:12},(s,a)=>e.jsx("option",{value:a+1,children:new Date(2023,a).toLocaleString("default",{month:"long"})},a+1))}),e.jsx(E,{value:i,onChange:s=>G(parseInt(s.target.value)),style:{width:"90px"},children:ce.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(l,{color:"primary",onClick:()=>p(!0),children:e.jsx(j,{icon:xe})}),e.jsx(l,{color:"primary",onClick:()=>setDeductionBonusModalVisible(!0),children:e.jsx(j,{icon:me})}),e.jsx(l,{color:"info",onClick:()=>g(!0),children:e.jsx(j,{icon:je})})]})]}),e.jsx(fe,{children:q&&M.length===0?e.jsx("div",{className:"text-center",children:e.jsx(he,{color:"primary"})}):e.jsx("div",{className:"table-responsive",children:e.jsxs(ye,{hover:!0,responsive:!0,children:[e.jsx(Ce,{children:e.jsxs(J,{children:[e.jsx(o,{children:"#"}),e.jsx(o,{children:"ID"}),e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Department"}),e.jsx(o,{children:"Job Position"}),e.jsx(o,{children:"Base Salary"}),e.jsx(o,{children:"Overtime"}),e.jsx(o,{children:"Tax"}),e.jsx(o,{children:"Benefits"}),e.jsx(o,{children:"Bonus"}),e.jsx(o,{children:"Net Salary"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Action"})]})}),e.jsx(Se,{children:M.map(s=>{const a=s.status||"Pending";return e.jsxs(J,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:s.employee_id}),e.jsx(n,{children:s.name}),e.jsx(n,{children:s.department}),e.jsx(n,{children:s.job_position}),e.jsx(n,{children:parseFloat(s.base_salary||0).toLocaleString()}),e.jsx(n,{children:parseFloat(s.total_overtime_amount||0).toFixed(2)}),e.jsxs(n,{children:["₱",parseFloat(s.tax||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(n,{children:parseFloat(s.benefits_total||0).toLocaleString()}),e.jsx(n,{children:parseFloat(s.bonus||0).toFixed(2)}),e.jsx(n,{children:parseFloat(s.net_salary||0).toLocaleString()}),e.jsx(n,{children:e.jsx(Fe,{color:de(a),children:a})}),e.jsxs(n,{children:[e.jsx(l,{color:"secondary",onClick:()=>ne(s),children:e.jsx(j,{icon:ue})}),e.jsxs(ve,{children:[e.jsx(De,{color:"link",size:"sm",children:e.jsx(j,{icon:pe})}),e.jsxs(Pe,{children:[e.jsx(Y,{onClick:()=>O(s.id,"Paid"),disabled:a==="Paid",children:"Paid"}),e.jsx(Y,{onClick:()=>O(s.id,"Pending"),disabled:a==="Pending",children:"Pending"})]})]})]})]},s.employee_id)})})]})})})]}),e.jsxs(f,{visible:F,onClose:()=>p(!1),children:[e.jsx(b,{children:e.jsx(y,{children:"Set Overtime Rate"})}),e.jsxs(C,{children:[e.jsx(S,{children:"Overtime Rate (per hour)"}),e.jsx(_,{type:"number",value:v,onChange:s=>k(s.target.value),placeholder:"Enter overtime rate"})]}),e.jsxs(B,{children:[e.jsx(l,{color:"secondary",onClick:()=>p(!1),children:"Close"}),e.jsx(l,{color:"primary",onClick:oe,children:"Save Rate"})]})]}),e.jsxs(f,{visible:D,onClose:()=>H(!1),children:[e.jsx(b,{children:e.jsx(y,{children:"Set Bonus"})}),e.jsxs(C,{children:[e.jsx(S,{className:"mt-3",children:"Bonus"}),e.jsx(_,{type:"number",value:V,onChange:s=>T(parseFloat(s.target.value)),placeholder:"Enter bonus"})]}),e.jsxs(B,{children:[e.jsx(l,{color:"secondary",onClick:()=>H(!1),children:"Close"}),e.jsx(l,{color:"primary",onClick:ie,children:"Save"})]})]}),e.jsxs(f,{visible:U,onClose:()=>g(!1),children:[e.jsx(b,{children:e.jsx(y,{children:"Manage Salaries"})}),e.jsxs(C,{children:[I&&e.jsx("div",{className:"alert alert-danger",children:I}),e.jsx(S,{children:"Job Position"}),e.jsxs(E,{value:P,onChange:s=>A(s.target.value),placeholder:"Select job position",children:[e.jsx("option",{value:"",children:"Select a job position"}),W.map((s,a)=>e.jsx("option",{value:s,children:s},a))]}),e.jsx(S,{className:"mt-3",children:"Base Salary"}),e.jsx(_,{type:"number",value:w,onChange:s=>R(s.target.value),placeholder:"Enter base salary"})]}),e.jsxs(B,{children:[e.jsx(l,{color:"secondary",onClick:()=>g(!1),children:"Close"}),e.jsx(l,{color:"primary",onClick:te,children:"Save Salary"})]})]}),e.jsxs(f,{visible:$,onClose:()=>K(!1),size:"lg",children:[e.jsx(b,{closeButton:!0,children:e.jsxs(y,{children:["Payslip for ",r==null?void 0:r.name]})}),e.jsx(C,{children:r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date Period:"})," ",N," 1, ",i," – ",N," 30,"," ",i]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee Name:"})," ",r.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee ID:"})," ",r.employee_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Position:"})," ",r.job_position]})]}),e.jsx("div",{className:"table-responsive",style:{overflowX:"auto"},children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Earnings"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Deductions"}),e.jsx("th",{children:"Amount"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Base Salary"}),e.jsxs("td",{children:["₱",parseFloat(r.base_salary||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{children:"Tax"}),e.jsxs("td",{children:["₱",parseFloat(r.tax||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Overtime Pay"}),e.jsxs("td",{children:["₱",parseFloat(r.total_overtime_amount||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{colSpan:"2"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Bonus"}),e.jsxs("td",{children:["₱",parseFloat(r.bonus||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),ee.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2"}),e.jsx("td",{children:s.type}),e.jsxs("td",{children:["₱",parseFloat(s.amount||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},a)),e.jsxs("tr",{children:[e.jsx("th",{children:"Gross Salary"}),e.jsxs("th",{children:["₱",(parseFloat(r.base_salary||0)+parseFloat(r.total_overtime_amount||0)+parseFloat(r.bonus||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("th",{children:"Total Deductions"}),e.jsxs("th",{children:["₱",(parseFloat(r.tax||0)+parseFloat(r.benefits_total||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Net Pay"}),e.jsxs("th",{colSpan:"3",children:["₱",(parseFloat(r.base_salary||0)+parseFloat(r.total_overtime_amount||0)+parseFloat(r.bonus||0)-parseFloat(r.tax||0)-parseFloat(r.benefits_total||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]})})]})]})};export{Ie as default};
