import{r as a,j as e,C as f,m as g}from"./index-WrjKmXgs.js";import{b as A,a as E,F as T,H as L}from"./index-BMI0ZrrN.js";import{C as B,a as H}from"./CCardBody-DanWnfWG.js";import{C as M}from"./CCardHeader-D-SmzBl0.js";import{C as y}from"./CFormSelect-C9Jitwj-.js";import{C as _}from"./CAlert-B1XC_8we.js";import{C as I,a as Y,b as C,c as l,d as R,e as o}from"./CTable-DvXfHdoe.js";import{C as $}from"./DefaultLayout-kwK9HI32.js";import"./CFormControlWrapper-_JJkpmBa.js";const Z=()=>{const[d,u]=a.useState([]),[m,c]=a.useState(!1),[p,n]=a.useState(null),[i,S]=a.useState(new Date().getMonth()+1),[r,w]=a.useState(new Date().getFullYear()),[x,D]=a.useState(new Date().toLocaleString("default",{month:"long"})),[k,z]=a.useState([]),[N,q]=a.useState("all"),j=async()=>{try{c(!0),n(null);const t=await g.get("/api/payslip",{params:{year:r,month:i}});u(Array.isArray(t.data)?t.data:[])}catch(t){console.error("Error fetching payslips:",t),n("Failed to fetch payslips"),u([])}finally{c(!1)}};a.useEffect(()=>{j()},[r,i,N]),a.useEffect(()=>{const t=new Date(r,i-1).toLocaleString("default",{month:"long"});D(t)},[i,r]);const v=async()=>{var t,s;if(window.confirm(`Are you sure you want to send payslips for ${x} ${r}?`)){c(!0),n(null);try{(await g.post("/api/release",{month:i,year:r})).data.count===0?n("No payroll records available to send as payslips"):(await j(),n(null))}catch(h){console.error("Error sending payslips:",h),n(((s=(t=h.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to send payslips")}finally{c(!1)}}},b=Array.from({length:new Date().getFullYear()-2020+1},(t,s)=>2020+s),F=t=>{if(!t)return"Not sent yet";try{const s=new Date(t);return isNaN(s.getTime())?"Invalid Date":s.toLocaleDateString()}catch{return"Invalid Date"}},P=t=>{switch(t){case"Sent":return"success";case"Pending":return"warning";case"Paid":return"primary";default:return"secondary"}};return e.jsx(A,{fluid:!0,children:e.jsxs(B,{children:[e.jsxs(M,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Payslip Management"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx(y,{value:i,onChange:t=>S(Number(t.target.value)),style:{width:"120px"},children:Array.from({length:12},(t,s)=>e.jsx("option",{value:s+1,children:new Date(2023,s).toLocaleString("default",{month:"long"})},s+1))}),e.jsx(y,{value:r,onChange:t=>w(Number(t.target.value)),style:{width:"100px"},children:b.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(E,{color:"primary",onClick:v,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"sm"})," Sending..."]}):e.jsx(e.Fragment,{children:e.jsx(T,{icon:L,className:"me-2"})})})]})]}),e.jsxs(H,{children:[p&&e.jsx(_,{color:"danger",dismissible:!0,onClose:()=>n(null),children:p}),m&&d.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsx(f,{color:"primary"})}):d.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsxs("p",{children:["No payslips found for ",x," ",r]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs(I,{hover:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(C,{children:[e.jsx(l,{children:"#"}),e.jsx(l,{children:"Employee ID"}),e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Department"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Sent Date"})]})}),e.jsx(R,{children:d.map((t,s)=>e.jsxs(C,{children:[e.jsx(o,{children:s+1}),e.jsx(o,{children:t.employee_id}),e.jsx(o,{children:t.name}),e.jsx(o,{children:t.department}),e.jsxs(o,{children:["â‚±",parseFloat(t.net_salary||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(o,{children:e.jsx($,{color:P(t.status),children:t.status})}),e.jsx(o,{children:F(t.issued_at)})]},t.id))})]})})]})]})})};export{Z as default};
