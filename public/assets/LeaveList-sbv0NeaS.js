import{r,j as e,C as q}from"./index-DLmnIqy-.js";import{a as b}from"./api-DwbPoVFv.js";import{F as x,x as E,a as I,y as N,z as B}from"./index-BzeTyS9E.js";import{C as _,a as H}from"./CCardBody-DfS5_nuD.js";import{C as $}from"./CCardHeader-BhAXpAMg.js";import{C as z}from"./CInputGroup-a2s_gtI6.js";import{C as G}from"./CFormInput-Dw_omB7Q.js";import{C as Q}from"./CInputGroupText-BZrPrPs0.js";import{C as M}from"./CFormSelect-CKgELBJY.js";import{C as O,a as J,b as P,c as n,d as K,e as i}from"./CTable-DPZp-y3R.js";import{a as U,b as V,c as W,d as X,e as u}from"./DefaultLayout-da0zcv8b.js";import{C as Y}from"./CFormCheck-BCNfbVL7.js";import{C as Z,a as j}from"./CPaginationItem-BIkS5v9r.js";import"./index-xsH4HHeE.js";import"./CFormControlWrapper-BnNbabf9.js";const je=()=>{const[m,c]=r.useState([]),[C,o]=r.useState([]),[R,g]=r.useState(!0),[f,T]=r.useState("all"),[k,D]=r.useState(""),[a,d]=r.useState(1),[y,v]=r.useState(1),w=10;r.useEffect(()=>{S()},[f,a]);const S=async()=>{try{g(!0);const t=(await b.get("/api/leave-requests/page",{params:{page:a,limit:w}})).data||{};Array.isArray(t.leaveRequests)?(c(t.leaveRequests),o(t.leaveRequests)):(c([]),o([])),v(t.totalPages||1)}catch(s){console.error("Error fetching leave list:",s),c([]),o([]),v(1)}finally{g(!1)}},h=async(s,t)=>{var l,L;try{await b.put(`/api/leave-requests/${s}`,{status:t}),S()}catch(p){console.error("Error updating leave status:",p),alert(`Failed to update leave status: ${((L=(l=p.response)==null?void 0:l.data)==null?void 0:L.message)||p.message}`)}},F=s=>{if(D(s),s.trim()==="")o(m);else{const t=m.filter(l=>l.name.toLowerCase().includes(s.trim().toLowerCase()));o(t)}},A=s=>{switch(s.toLowerCase()){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";default:return"secondary"}};return e.jsxs(_,{children:[e.jsxs($,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Leave Requests"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(z,{style:{width:"200px"},children:[e.jsx(G,{type:"text",placeholder:"Search...",value:k,onChange:s=>F(s.target.value)}),e.jsx(Q,{children:e.jsx(x,{icon:E})})]}),e.jsxs(M,{value:f,onChange:s=>T(s.target.value),style:{width:"150px"},children:[e.jsx("option",{value:"all",children:"All Requests"}),e.jsx("option",{value:"last24",children:"Last 24 Hours"}),e.jsx("option",{value:"recent",children:"Recent (Last 7 Days)"}),e.jsx("option",{value:"old",children:"Older"})]})]})]}),e.jsx(H,{children:R?e.jsxs("div",{className:"text-center",children:[e.jsx(q,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):C.length===0?e.jsx("div",{className:"text-center",children:e.jsx("p",{children:"No leave request found."})}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{hover:!0,responsive:!0,children:[e.jsx(J,{children:e.jsxs(P,{children:[e.jsx(n,{children:"#"}),e.jsx(n,{children:"Employee"}),e.jsx(n,{children:"Date Requested"}),e.jsx(n,{children:"Leave Type"}),e.jsx(n,{children:"Days"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Paid"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(K,{children:C.map((s,t)=>e.jsxs(P,{children:[e.jsx(i,{children:(a-1)*w+t+1}),e.jsx(i,{children:s.name}),e.jsx(i,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(i,{children:s.leave_type}),e.jsx(i,{children:s.total_days}),e.jsx(i,{children:e.jsx(U,{color:A(s.status),children:s.status})}),e.jsx(i,{children:e.jsx(Y,{id:`paid-checkbox-${s.id}`,checked:s.is_paid,onChange:()=>{}})}),e.jsxs(i,{children:[e.jsx(I,{color:"link",children:e.jsx(x,{icon:N})}),e.jsxs(V,{children:[e.jsx(W,{color:"link",size:"sm",children:e.jsx(x,{icon:B})}),e.jsxs(X,{children:[e.jsx(u,{onClick:()=>h(s.id,"Approved"),disabled:s.status==="Approved",children:"Approved"}),e.jsx(u,{onClick:()=>h(s.id,"Rejected"),disabled:s.status==="Rejected",children:"Rejected"}),e.jsx(u,{onClick:()=>h(s.id,"Pending"),disabled:s.status==="Pending",children:"Pending"})]})]})]})]},s.id))})]}),e.jsxs(Z,{align:"center",className:"mt-3",children:[e.jsx(j,{disabled:a===1,onClick:()=>d(a-1),children:"«"}),Array.from({length:y},(s,t)=>e.jsx(j,{active:t+1===a,onClick:()=>d(t+1),children:t+1},t+1)),e.jsx(j,{disabled:a===y,onClick:()=>d(a+1),children:"»"})]})]})})]})};export{je as default};
