import{r as t,j as e,C as Q}from"./index-DXiirQRx.js";import{C as u,a as i}from"./index-OZHYTCeR.js";import{a as c,F as P,s as W,t as X}from"./index-Cg_UBKJG.js";import{C as Z,a as ee}from"./CCardBody-BUhW-l3R.js";import{C as ae}from"./CCardHeader-BnPxTvfx.js";import{C as B}from"./CFormSelect-DTDeymM8.js";import{C as se,a as te,b as k,c as r,d as re,e as o}from"./CTable-B7cNnFp6.js";import{C as oe,a as ne,b as le,c as ce,d as M}from"./DefaultLayout-BYzA4Qo5.js";import{C as N,a as _,b as I,c as L,d as T}from"./CModalTitle-DIZXrOAx.js";import{C as p}from"./CFormInput-HYtjY2kQ.js";const fe=()=>{const[C,y]=t.useState([]),[A,x]=t.useState(!0),[n,H]=t.useState(new Date().getMonth()+1),[l,O]=t.useState(new Date().getFullYear()),[ie,V]=t.useState(new Date().toLocaleString("default",{month:"long"})),[m,d]=t.useState(!1),[f,v]=t.useState(""),[S,b]=t.useState(""),[j,h]=t.useState(!1),[w,F]=t.useState(0),[D,E]=t.useState(0),g=async()=>{try{x(!0);const s=(await i.get("http://localhost:8000/api/payroll",{params:{year:l,month:n}})).data;console.log("API Response:",s),Array.isArray(s)?y(s):(console.error("Invalid data format:",s),y([])),x(!1)}catch(a){console.error("Error fetching payroll data:",a),x(!1)}};t.useEffect(()=>{g()},[l,n]),t.useEffect(()=>{const a=new Date(l,n-1).toLocaleString("default",{month:"long"});V(a)},[n,l]);const Y=async()=>{try{const s=(await i.get("http://localhost:8000/api/rates")).data;v(s.salary_rate||""),b(s.overtime_rate||"")}catch(a){console.error("Error fetching rates:",a)}};t.useEffect(()=>{m&&Y()},[m]);const z=async()=>{try{const a=await i.post("http://localhost:8000/api/rates",{salary_rate:parseFloat(f),overtime_rate:parseFloat(S)});console.log("Rates saved successfully:",a.data),d(!1)}catch(a){console.error("Error saving rates:",a)}},R=async(a,s)=>{try{await i.put(`http://localhost:8000/api/payrolls/${a}`,{status:s}),g()}catch(K){console.error("Error updating paid status:",K),alert("Failed to update paid status. Please try again.")}},$=async()=>{try{const a=await i.post("http://localhost:8000/api/payroll",{year:l,month:n,deduction:parseFloat(w),bonus:parseFloat(D)});h(!1),g()}catch(a){console.error("Error saving deduction and bonus:",a)}},U=async()=>{try{const s=(await i.get("http://localhost:8000/api/payroll",{params:{year:l,month:n}})).data;s.length>0&&(F(s[0].deduction||0),E(s[0].bonus||0))}catch(a){console.error("Error fetching deduction and bonus:",a)}};t.useEffect(()=>{j&&U()},[j]);const q=a=>{window.open(`http://localhost:8000/api/payroll/generate-payslip/${a}?view=true`,"_blank")},G=Array.from({length:new Date().getFullYear()-2020+1},(a,s)=>2020+s),J=a=>{switch(a.toLowerCase()){case"pending":return"success";case"paid":return"warning";default:return"secondary"}};return e.jsxs("div",{children:[e.jsxs(Z,{children:[e.jsxs(ae,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Employee Payroll"}),e.jsxs("div",{className:"float-end",children:[e.jsx(B,{value:n,onChange:a=>H(parseInt(a.target.value)),style:{width:"120px",display:"inline-block",marginRight:"10px"},children:Array.from({length:12},(a,s)=>e.jsx("option",{value:s+1,children:new Date(2023,s).toLocaleString("default",{month:"long"})},s+1))}),e.jsx(B,{value:l,onChange:a=>O(parseInt(a.target.value)),style:{width:"90px",display:"inline-block",marginRight:"10px"},children:G.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx(c,{className:"me-2",color:"primary",onClick:()=>d(!0),children:"Rates"}),e.jsx(c,{color:"primary",onClick:()=>h(!0),children:"Set"})]})]}),e.jsx(ee,{children:A&&C.length===0?e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):e.jsxs(se,{hover:!0,responsive:!0,children:[e.jsx(te,{children:e.jsxs(k,{children:[e.jsx(r,{children:"#"}),e.jsx(r,{children:"ID"}),e.jsx(r,{children:"Name"}),e.jsx(r,{children:"Overtime"}),e.jsx(r,{children:"Deduction"}),e.jsx(r,{children:"Bonus"}),e.jsx(r,{children:"Net Salary"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Action"})]})}),e.jsx(re,{children:C.map(a=>e.jsxs(k,{children:[e.jsx(o,{children:a.id}),e.jsx(o,{children:a.employee_id}),e.jsx(o,{children:a.name}),e.jsx(o,{children:parseFloat(a.total_overtime_amount).toFixed(2)}),e.jsx(o,{children:parseFloat(a.deduction).toFixed(2)}),e.jsx(o,{children:parseFloat(a.bonus).toFixed(2)}),e.jsx(o,{children:parseFloat(a.net_salary).toLocaleString("en-US",{style:"currency",currency:"PHP",minimumFractionDigits:2})}),e.jsx(o,{children:e.jsx(oe,{color:J(a.status),children:a.status})}),e.jsxs(o,{children:[e.jsx(c,{className:"me-2",color:"success",size:"sm",onClick:()=>q(a.id),children:e.jsx(P,{icon:W})}),e.jsxs(ne,{children:[e.jsx(le,{color:"link",size:"sm",children:e.jsx(P,{icon:X})}),e.jsxs(ce,{children:[e.jsx(M,{onClick:()=>R(a.id,"Paid"),disabled:a.status==="Paid",children:"Paid"}),e.jsx(M,{onClick:()=>R(a.id,"Pending"),disabled:a.status==="Pending",children:"Pending"})]})]})]})]},a.employee_id))})]})})]}),e.jsxs(N,{visible:m,onClose:()=>d(!1),children:[e.jsx(_,{children:e.jsx(I,{children:"Set Salary and Overtime Rates"})}),e.jsxs(L,{children:[e.jsx(u,{children:"Salary Rate (per hour)"}),e.jsx(p,{type:"number",value:f,onChange:a=>v(a.target.value),placeholder:"Enter salary rate"}),e.jsx(u,{className:"mt-3",children:"Overtime Rate (per hour)"}),e.jsx(p,{type:"number",value:S,onChange:a=>b(a.target.value),placeholder:"Enter overtime rate"})]}),e.jsxs(T,{children:[e.jsx(c,{color:"secondary",onClick:()=>d(!1),children:"Close"}),e.jsx(c,{color:"primary",onClick:z,children:"Save Rates"})]})]}),e.jsxs(N,{visible:j,onClose:()=>h(!1),children:[e.jsx(_,{children:e.jsx(I,{children:"Set Deduction and Bonus"})}),e.jsxs(L,{children:[e.jsx(u,{children:"Deduction"}),e.jsx(p,{type:"number",value:w,onChange:a=>F(parseFloat(a.target.value)),placeholder:"Enter deduction"}),e.jsx(u,{className:"mt-3",children:"Bonus"}),e.jsx(p,{type:"number",value:D,onChange:a=>E(parseFloat(a.target.value)),placeholder:"Enter bonus"})]}),e.jsxs(T,{children:[e.jsx(c,{color:"secondary",onClick:()=>h(!1),children:"Close"}),e.jsx(c,{color:"primary",onClick:$,children:"Save"})]})]})]})};export{fe as default};
