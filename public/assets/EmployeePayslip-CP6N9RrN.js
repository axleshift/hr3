import{r as o,j as e,C as p,d as g}from"./index-B1cYRwuN.js";import{b as y,F as C,k as M,o as k}from"./Compliance-DPMZF7rg.js";import{C as R,a as U}from"./CCardBody-DiDY8RMx.js";import{C as O}from"./CCardHeader-CD8D4PQY.js";import{C as P}from"./CAlert-tQDp2MAV.js";import{C as Y,a as z,b as w,c as d,d as G,e as c}from"./CTable-RpRI7F68.js";import{C as V,a as W,b as X,c as q}from"./CModalTitle-CQk_jaTA.js";import"./DefaultLayout-DthfV9Qz.js";const oe=()=>{const[f,x]=o.useState([]),[D,_]=o.useState(!0),[b,r]=o.useState(null),[v,S]=o.useState(!1),[t,L]=o.useState(null),[J,N]=o.useState(new Date().toLocaleString("default",{month:"long"})),[F,E]=o.useState(new Date().getFullYear()),[m,h]=o.useState(!1),u="http://localhost:8000/api/releases",j=s=>{const a=new Date;return a.setMonth(s-1),a.toLocaleString("default",{month:"long"})},I=async()=>{try{const s=sessionStorage.getItem("user_id");if(!s){r("User ID not found in session. Please log in again.");return}const a=await g.get(`${u}`,{params:{user_id:s}});console.log("API Response:",a.data),Array.isArray(a.data.payslips)?x(a.data.payslips):(r("Invalid payslip data format."),x([]))}catch(s){console.error("Error fetching payslips:",s),s.response&&s.response.status===404?r("No payslips found for the specified employee."):r("Failed to fetch payslips. Please try again later."),x([])}finally{_(!1)}};o.useEffect(()=>{I()},[]);const $=s=>{L(s);const a=j(s.month),i=s.year;`${i}${String(s.month).padStart(2,"0")}`,new Date(i,s.month,0).toISOString().split("T")[0],N(a),E(i),S(!0)},A=async(s,a,i)=>{h(!0);try{const n=await g.get(`${u}/download/${s}`,{responseType:"blob"}),T=j(i),B=window.URL.createObjectURL(new Blob([n.data])),l=document.createElement("a");l.href=B,l.setAttribute("download",`Payslip-${T}-${a}.pdf`),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(n){console.error("Error downloading payslip:",n),r("Failed to download payslip. Please try again.")}finally{h(!1)}},H=async()=>{h(!0);try{const s=sessionStorage.getItem("user_id");if(!s){r("User ID not found in session. Please log in again.");return}const a=await g.get(`${u}/download-all`,{params:{user_id:s},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([a.data])),n=document.createElement("a");n.href=i,n.setAttribute("download","all-payslips.pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(s){console.error("Error downloading all payslips:",s),r("Failed to download all payslips. Please try again.")}finally{h(!1)}};return e.jsxs(R,{children:[e.jsxs(O,{children:[e.jsx("strong",{children:"My Payslips"}),e.jsx(y,{color:"primary",className:"float-end",onClick:H,disabled:m,children:m?e.jsx(p,{size:"sm"}):"Download All Payslips"})]}),e.jsx(U,{children:D?e.jsxs("div",{className:"text-center",children:[e.jsx(p,{color:"primary"}),e.jsx("p",{children:"Loading payslips..."})]}):b?e.jsx(P,{color:"danger",children:b}):f.length===0?e.jsx(P,{color:"info",children:"No payslips available."}):e.jsxs(Y,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(z,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Month"}),e.jsx(d,{children:"Year"}),e.jsx(d,{children:"Net Salary"}),e.jsx(d,{children:"Status"}),e.jsx(d,{})]})}),e.jsx(G,{children:f.map(s=>e.jsxs(w,{children:[e.jsx(c,{children:j(s.month)}),e.jsx(c,{children:s.year}),e.jsx(c,{children:parseFloat(s.net_salary||0).toLocaleString("en-US",{style:"currency",currency:"PHP",minimumFractionDigits:2})}),e.jsx(c,{children:e.jsx("span",{style:{color:s.status==="Paid"?"green":"orange",fontWeight:"bold"},children:s.status})}),e.jsxs(c,{children:[e.jsx(y,{color:"secondary",onClick:()=>$(s),children:e.jsx(C,{icon:M})}),e.jsx(y,{color:"success",className:"ms-2",onClick:()=>A(s.employee_id,s.name,s.month),disabled:m,children:m?e.jsx(p,{size:"sm"}):e.jsx(C,{icon:k})})]})]},s.id||`${s.user_id}-${s.month}-${s.year}`))})]})}),e.jsxs(V,{visible:v,onClose:()=>S(!1),size:"lg",children:[e.jsx(W,{closeButton:!0,children:e.jsxs(X,{children:["Payslip for ",t==null?void 0:t.name]})}),e.jsx(q,{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pay Period:"})," ",`${F}-${String(t.month).padStart(2,"0")}-01`," –"," ",new Date(F,t.month,0).toISOString().split("T")[0]]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee Name:"})," ",t.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee ID:"})," ",t.employee_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Position:"})," ",t.job_position]})]}),e.jsx("div",{className:"table-responsive",style:{overflowX:"auto"},children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Earnings"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Deductions"}),e.jsx("th",{children:"Amount"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Base Salary"}),e.jsxs("td",{children:["₱",parseFloat(t.base_salary||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{children:"Deduction"}),e.jsxs("td",{children:["₱",parseFloat(t.deduction||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Overtime Pay"}),e.jsxs("td",{children:["₱",parseFloat(t.total_overtime_amount||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Bonus"}),e.jsxs("td",{children:["₱",parseFloat(t.bonus||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Gross Salary"}),e.jsxs("th",{children:["₱",(parseFloat(t.base_salary||0)+parseFloat(t.total_overtime_amount||0)+parseFloat(t.bonus||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("th",{children:"Total Deductions"}),e.jsxs("th",{children:["₱",parseFloat(t.deduction||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Net Pay"}),e.jsxs("th",{colSpan:"3",children:["₱",(parseFloat(t.base_salary||0)+parseFloat(t.total_overtime_amount||0)+parseFloat(t.bonus||0)-parseFloat(t.deduction||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]})})]})]})};export{oe as default};
