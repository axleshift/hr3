import{i as V,r,j as e,C as P,R as U,m as p}from"./index-DPw8gujG.js";import{a as x,F as _,r as $,s as q}from"./index-C6IL73NQ.js";import{C as J,a as K}from"./CRow-D3hSlMtw.js";import{C as Q,a as W}from"./CCardBody-B_tImLmD.js";import{C as X}from"./CCardHeader-B-D2uoQY.js";import{C as Y,a as Z,b as j,c as i,d as ee,e as l}from"./CTable-2gP5Af63.js";import{C as se,a as te,b as ae,c as ne}from"./CModalTitle-Cu5wGtYg.js";import{C as N}from"./CInputGroup-DWtEyvkN.js";import{C as B}from"./CInputGroupText-DPJJAN8w.js";import{C as k}from"./CFormSelect-CjNSZl2o.js";import{C as re}from"./CFormInput-qOImCO0-.js";import{C as le}from"./CModalFooter-CAEJ9O7Q.js";import{C as w}from"./DefaultLayout-DyfB1xHN.js";import"./CFormControlWrapper-Mr3y5RG-.js";const Se=()=>{V();const[f,C]=r.useState(""),[g,v]=r.useState(""),[A,y]=r.useState("Active"),[ie,F]=r.useState([]),[E,T]=r.useState({}),[S,m]=r.useState(!1),[I,u]=r.useState(null),[D,d]=r.useState(!1),[b,M]=r.useState(null),H=["Pag-ibig","SSS","PhilHealth","13th Month Pay","Service Incentive Leave"],R=[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}];r.useEffect(()=>{(async()=>{try{m(!0);const a=await p.get("/benefits?status=Active");F(a.data);const o=a.data.reduce((t,n)=>(t[n.employee_id]||(t[n.employee_id]=[]),t[n.employee_id].push(n),t),{});T(o)}catch(a){console.error("Error fetching benefits:",a),u("Failed to fetch benefits.")}finally{m(!1)}})()},[]);const L=async()=>{var a,o,t;if(!f||!g){u("Please select a benefit type and enter an amount.");return}m(!0),u(null);const s={type:f,amount:parseFloat(g),status:A||"Active"};try{if(b)await p.put(`/benefits/${b.id}`,s),alert("Benefit updated successfully!");else{const c=await p.post("/benefits",s);console.log("Success:",c.data),alert("Benefit applied successfully!")}const n=await p.get("/benefits?status=Active");F(n.data);const z=n.data.reduce((c,h)=>(c[h.employee_id]||(c[h.employee_id]=[]),c[h.employee_id].push(h),c),{});T(z),d(!1),C(""),v(""),y("Active"),M(null)}catch(n){console.error("Error:",((a=n.response)==null?void 0:a.data)||n.message),u(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.error)||"Failed to apply/update benefit.")}finally{m(!1)}},G=s=>{M(s),C(s.type),v(s.amount),y(s.status),d(!0)},O=s=>{switch(s){case"Active":return e.jsx(w,{color:"success",children:"Active"});case"Inactive":return e.jsx(w,{color:"danger",children:"Inactive"});default:return e.jsx(w,{color:"secondary",children:"Unknown"})}};return e.jsx(J,{children:e.jsx(K,{xs:12,children:e.jsxs(Q,{className:"mb-4",children:[e.jsxs(X,{className:"d-flex justify-content-between align-items-center flex-wrap gap-2",children:[e.jsx("strong",{children:"Manage Employee Benefits"}),e.jsx("div",{className:"float-end",children:e.jsx(x,{color:"primary",onClick:()=>d(!0),children:e.jsx(_,{icon:$})})})]}),e.jsxs(W,{children:[I&&e.jsx("div",{className:"alert alert-danger mb-3",children:I}),e.jsxs(Y,{hover:!0,responsive:!0,children:[e.jsx(Z,{children:e.jsxs(j,{children:[e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Employee ID"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Benefit Type"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(ee,{children:S?e.jsx(j,{children:e.jsxs(l,{colSpan:7,className:"text-center",children:[e.jsx(P,{}),e.jsx("span",{className:"ms-2",children:"Loading benefits..."})]})}):Object.keys(E).length===0?e.jsx(j,{children:e.jsx(l,{colSpan:7,className:"text-center",children:"No benefits found"})}):Object.entries(E).map(([s,a],o)=>e.jsx(U.Fragment,{children:a.map((t,n)=>e.jsxs(j,{children:[n===0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{rowSpan:a.length,className:"text-center align-middle",children:o+1}),e.jsx(l,{rowSpan:a.length,className:"text-center align-middle",children:t.employee_id}),e.jsx(l,{rowSpan:a.length,className:"text-center align-middle",children:t.name})]}),e.jsx(l,{children:t.type}),e.jsxs(l,{children:["â‚±",parseFloat(t.amount).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(l,{children:O(t.status)}),e.jsx(l,{children:e.jsx(x,{color:"warning",size:"sm",onClick:()=>G(t),className:"me-2",children:e.jsx(_,{icon:q})})})]},t.id))},s))})]}),e.jsxs(se,{visible:D,onClose:()=>d(!1),children:[e.jsx(te,{children:e.jsx(ae,{children:b?"Edit Benefit":"Add New Benefit"})}),e.jsxs(ne,{children:[e.jsxs(N,{className:"mb-3",children:[e.jsx(B,{children:"Benefit Type"}),e.jsxs(k,{value:f,onChange:s=>C(s.target.value),children:[e.jsx("option",{value:"",children:"Select benefit type"}),H.map((s,a)=>e.jsx("option",{value:s,children:s},a))]})]}),e.jsxs(N,{className:"mb-3",children:[e.jsx(B,{children:"Amount"}),e.jsx(re,{type:"number",placeholder:"Enter amount",value:g,onChange:s=>v(s.target.value)})]}),e.jsxs(N,{className:"mb-3",children:[e.jsx(B,{children:"Status"}),e.jsx(k,{value:A,onChange:s=>y(s.target.value),children:R.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs(le,{children:[e.jsx(x,{color:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{color:"primary",onClick:L,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(P,{component:"span",size:"sm","aria-hidden":"true"}),e.jsx("span",{className:"ms-2",children:"Processing..."})]}):"Submit"})]})]})]})]})})})};export{Se as default};
