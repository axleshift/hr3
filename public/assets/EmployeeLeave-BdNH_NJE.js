import{r as a,m as f,j as e,C as E}from"./index-Y44Ldxrt.js";import{C as F,a as M}from"./CCardBody-CBtb8McC.js";import{C as B}from"./CCardHeader-uNRxC_5E.js";import{C as A,a as N,b as m,c as o,d as _,e as t}from"./CTable-Dc7j-tW1.js";import{C as w}from"./DefaultLayout-porhYt5a.js";import{C as D,a as H,b as P,c as V,d as k}from"./CModalTitle-NqWp794i.js";import{a as I,C as O}from"./CForm-qMLrmxec.js";import{C as $}from"./CFormSelect-BS2OFBr_.js";import{C as z}from"./CFormTextarea-CV3cfOYL.js";import{a as G}from"./index-BrEmiYF0.js";import"./CFormControlWrapper-mr0PDOF2.js";const re=()=>{const[x,L]=a.useState([]),[S,i]=a.useState(!0),[v,h]=a.useState(null),[T,j]=a.useState(!1),[n,C]=a.useState(""),[d,y]=a.useState(""),[c,u]=a.useState({visible:!1,type:"",message:""}),r=sessionStorage.getItem("employee_id");a.useEffect(()=>{if(!r){h("Employee ID not found. Please log in again."),i(!1);return}g()},[r]);const g=a.useCallback(async()=>{try{i(!0);const s=await f.get(`/leave-requests/${r}`);L(s.data.leaveRequests)}catch{h("Failed to load leave requests. Please try again later.")}finally{i(!1)}},[r]),q=s=>{switch(s){case"Pending":return"primary";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},R=async s=>{var l,b;if(s.preventDefault(),!n||!d){u({visible:!0,type:"danger",message:"Leave Type and Reason are required."});return}try{const p=await f.post("/leave-request",{employee_id:r,leave_type:n,reason:d,status:"Pending"});u({visible:!0,type:"success",message:"Leave request submitted successfully!"}),C(""),y(""),g(),setTimeout(()=>{j(!1)},2e3)}catch(p){u({visible:!0,type:"danger",message:(b=(l=p.response)==null?void 0:l.data)!=null&&b.errors?Object.values(p.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return e.jsxs(F,{children:[e.jsx(B,{children:e.jsx("strong",{children:"My Leave Requests"})}),e.jsx(M,{children:S?e.jsxs("div",{className:"text-center",children:[e.jsx(E,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):v?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:v})}):e.jsxs(A,{hover:!0,responsive:!0,children:[e.jsx(N,{children:e.jsxs(m,{children:[e.jsx(o,{children:"#"}),e.jsx(o,{children:"Leave Type"}),e.jsx(o,{children:"Approved Date"}),e.jsx(o,{children:"Status"})]})}),e.jsx(_,{children:x.length===0?e.jsx(m,{children:e.jsx(t,{colSpan:"4",className:"text-center",children:"No leave requests available."})}):x.map((s,l)=>e.jsxs(m,{children:[e.jsx(t,{children:l+1}),e.jsx(t,{children:s.leave_type}),e.jsx(t,{children:s.approved_date||"N/A"}),e.jsx(t,{children:e.jsx(w,{color:q(s.status),children:s.status})})]},s.id))})]})}),e.jsxs(D,{visible:T,onClose:()=>j(!1),children:[e.jsx(H,{children:e.jsx(P,{children:"Leave Request"})}),e.jsxs(V,{children:[c.visible&&e.jsx(I,{color:c.type,dismissible:!0,children:c.message}),e.jsxs(O,{onSubmit:R,id:"leaveForm",children:[e.jsxs($,{label:"Leave Type",value:n,onChange:s=>C(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation Leave",children:"Vacation Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"})]}),e.jsx("br",{}),e.jsx(z,{label:"Reason",value:d,onChange:s=>y(s.target.value),required:!0}),e.jsx("br",{})]})]}),e.jsx(k,{children:e.jsx(G,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]})]})};export{re as default};
