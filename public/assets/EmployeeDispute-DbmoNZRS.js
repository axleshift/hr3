import{r,j as e,C as T}from"./index-DLmnIqy-.js";import{a as P}from"./api-DwbPoVFv.js";import{C as G,a as O}from"./CRow-D_sGLWX_.js";import{C as W,a as $}from"./CCardBody-DfS5_nuD.js";import{C as J}from"./CCardHeader-BhAXpAMg.js";import{a as o}from"./index-BzeTyS9E.js";import{C as E}from"./CAlert-BZjV-HHH.js";import{C as K,a as Q,b as f,c as C,d as X,e as n}from"./CTable-DPZp-y3R.js";import{a as I}from"./DefaultLayout-da0zcv8b.js";import{C as M,a as B,b as L,c as F}from"./CModalTitle-C2yBrXNe.js";import{C as Y}from"./CForm-jbt0bXtC.js";import{C as Z}from"./CFormSelect-CKgELBJY.js";import{C as ee}from"./CFormInput-Dw_omB7Q.js";import{C as se}from"./CFormTextarea-CdW_KHwp.js";import{C as R}from"./CModalFooter-BqkdO2U_.js";import{C as te,a as d}from"./CListGroupItem-BkaPsGJt.js";import"./index-xsH4HHeE.js";import"./CFormControlWrapper-BnNbabf9.js";const ve=()=>{var _;const[b,y]=r.useState([]),[t,k]=r.useState(null),[A,c]=r.useState(!1),[H,u]=r.useState(!1),[p,m]=r.useState(!0),[v,D]=r.useState(null),[a,x]=r.useState({visible:!1,type:"",message:""}),[i,j]=r.useState({type:"wages",description:"",pay_period:""}),[re,q]=r.useState({status:"under_review",resolution_notes:""}),l=sessionStorage.getItem("user_id"),z=sessionStorage.getItem("name");r.useEffect(()=>{if(a.visible){const s=setTimeout(()=>x({...a,visible:!1}),3e3);return()=>clearTimeout(s)}},[a]),r.useEffect(()=>{if(!l){D("User ID not found. Please log in again."),m(!1);return}S()},[l]);const U=s=>{k(s),q({status:s.status,resolution_notes:s.resolution_notes||""}),u(!0)},S=async()=>{try{m(!0);const s=await P.get(`/dispute/${l}`);console.log("API Response:",s.data);const h=Array.isArray(s.data)?s.data:[];y(h)}catch(s){D("Failed to load disputes. Please try again later."),console.error("Error fetching disputes:",s),y([])}finally{m(!1)}},V=async s=>{var h,N;if(s.preventDefault(),!l||isNaN(l)){x({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}try{m(!0);const g={...i,user_id:l,name:z||""};await P.post("/disputes",g),x({visible:!0,type:"success",message:"Dispute submitted successfully!"}),c(!1),j({type:"wages",description:"",pay_period:""}),await S()}catch(g){console.error("Error submitting dispute:",g),x({visible:!0,type:"danger",message:((N=(h=g.response)==null?void 0:h.data)==null?void 0:N.message)||"Failed to submit dispute. Please try again."})}finally{m(!1)}},w=s=>({submitted:"warning",under_review:"info",resolved:"success",rejected:"danger"})[s]||"secondary";return p&&b.length===0?e.jsxs("div",{className:"text-center",children:[e.jsx(T,{color:"primary"}),e.jsx("p",{children:"Loading disputes..."})]}):v?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:v})}):e.jsxs(G,{children:[e.jsx(O,{xs:12,children:e.jsxs(W,{className:"mb-4",children:[e.jsxs(J,{children:[e.jsx("strong",{children:"Wage Disputes"}),e.jsx(o,{color:"primary",className:"float-end",onClick:()=>c(!0),disabled:p,children:"Submit New Dispute"})]}),e.jsxs($,{children:[a.visible&&e.jsx(E,{color:a.type,dismissible:!0,children:a.message}),e.jsxs(K,{striped:!0,hover:!0,children:[e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(C,{children:"Type"}),e.jsx(C,{children:"Pay Period"}),e.jsx(C,{children:"Status"}),e.jsx(C,{children:"Submitted Date"})]})}),e.jsx(X,{children:b.length===0?e.jsx(f,{children:e.jsx(n,{colSpan:"4",className:"text-center",children:"No disputes found."})}):b.map(s=>e.jsxs(f,{children:[e.jsx(n,{children:s.type}),e.jsx(n,{children:new Date(s.pay_period).toLocaleDateString()}),e.jsx(n,{children:e.jsx(I,{color:w(s.status),children:s.status.replace("_"," ")})}),e.jsx(n,{children:new Date(s.created_at).toLocaleString()}),e.jsx(n,{children:e.jsx(o,{color:"primary",size:"sm",onClick:()=>U(s),children:"View"})})]},s.id))})]})]})]})}),e.jsxs(M,{visible:A?!0:void 0,onClose:()=>c(!1),children:[e.jsx(B,{onClose:()=>c(!1),children:e.jsx(L,{children:"Submit New Dispute"})}),e.jsxs(Y,{onSubmit:V,children:[e.jsxs(F,{children:[a.visible&&e.jsx(E,{color:a.type,dismissible:!0,children:a.message}),e.jsx("div",{className:"mb-3",children:e.jsx(Z,{id:"type",label:"Dispute Type",value:i.type,onChange:s=>j({...i,type:s.target.value}),options:[{label:"Wages",value:"wages"},{label:"Hours",value:"hours"},{label:"Deductions",value:"deductions"},{label:"Bonuses",value:"bonuses"},{label:"Taxes",value:"taxes"},{label:"Benefits",value:"benefits"},{label:"Other",value:"other"}],required:!0})}),e.jsx("div",{className:"mb-3",children:e.jsx(ee,{type:"date",id:"pay_period",label:"Pay Period Date",value:i.pay_period,onChange:s=>j({...i,pay_period:s.target.value}),required:!0})}),e.jsx("div",{className:"mb-3",children:e.jsx(se,{id:"description",label:"Description",value:i.description,onChange:s=>j({...i,description:s.target.value}),rows:5,required:!0})})]}),e.jsxs(R,{children:[e.jsx(o,{color:"secondary",onClick:()=>c(!1),disabled:p,children:"Cancel"}),e.jsx(o,{color:"primary",type:"submit",disabled:p,children:p?e.jsx(T,{size:"sm"}):"Submit Dispute"})]})]})]}),e.jsxs(M,{size:"lg",visible:H,onClose:()=>u(!1),children:[e.jsx(B,{onClose:()=>u(!1),children:e.jsxs(L,{children:["Dispute Details",e.jsx(I,{color:w(t==null?void 0:t.status),className:"ms-2",children:t==null?void 0:t.status.replace("_"," ")})]})}),e.jsx(F,{children:t&&e.jsxs(te,{children:[e.jsxs(d,{children:[e.jsx("strong",{children:"Employee:"})," ",(_=t.user)==null?void 0:_.name]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Type:"})," ",t.type]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Pay Period:"})," ",new Date(t.pay_period).toLocaleDateString()]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Submitted:"})," ",new Date(t.created_at).toLocaleString()]}),e.jsxs(d,{children:[e.jsx("strong",{children:"Description:"}),e.jsx("div",{className:"mt-2 p-2 bg-light rounded",children:t.description})]}),t.resolution_notes&&e.jsxs(d,{children:[e.jsx("strong",{children:"Resolution Notes:"}),e.jsx("div",{className:"mt-2 p-2 bg-light rounded",children:t.resolution_notes})]})]})}),e.jsxs(R,{children:[e.jsx(o,{color:"secondary",onClick:()=>u(!1),children:"Close"}),t&&e.jsx(o,{color:"primary",onClick:()=>{u(!1),handleOpenResolution(t)},children:"Update Status"})]})]})]})};export{ve as default};
