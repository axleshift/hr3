import{r as n,u as F,c as _,j as e,a as R}from"./index-CB7OUzk2.js";import{C as q,a as v}from"./CRow-X1-exVaw.js";import{C as w,a as I}from"./CCardBody-CmvYpM3N.js";import{C as B}from"./CCardHeader-BhOK-01F.js";import{C as k}from"./CAlert-D4mvLiKr.js";import{C as A}from"./CForm-B7YWwKjn.js";import{C as P}from"./CFormSelect-D7c-pNlG.js";import{C as x}from"./CFormInput-CEPgCUNz.js";import{C as V}from"./CFormTextarea-CNYmDnM1.js";import{b as M}from"./Compliance-lCZO8XuK.js";import"./CFormControlWrapper-BnsjPntT.js";const Z=()=>{const[m,g]=n.useState(""),[o,j]=n.useState(""),[l,h]=n.useState(""),[p,f]=n.useState(""),[C,b]=n.useState(null),[s,y]=n.useState({}),[i,d]=n.useState({visible:!1,type:"",message:""});F();const E=_(),u={user_id:sessionStorage.getItem("user_id")||"",name:sessionStorage.getItem("name")||""},T=a=>{const t=a.target.files[0];t&&b(t)},N=async a=>{var D,S,L;if(a.preventDefault(),!u.user_id||isNaN(u.user_id)){d({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}const t={};if(m.trim()||(t.leaveType="Leave Type is required"),o.trim()||(t.startDate="Start Date is required"),l.trim()?new Date(o)>new Date(l)&&(t.endDate="End Date must be after Start Date"):t.endDate="End Date is required",p.trim()||(t.reason="Reason is required"),Object.keys(t).length>0){y(t);return}y({});const r=new FormData;r.append("user_id",u.user_id),r.append("name",u.name),r.append("leave_type",m),r.append("start_date",o),r.append("end_date",l),r.append("reason",p),C&&r.append("document",C);try{const c=await R.post("/api/leave-requests",r,{headers:{"Content-Type":"multipart/form-data"}});d({visible:!0,type:"success",message:"Leave request submitted successfully!"}),g(""),j(""),h(""),f(""),b(null)}catch(c){console.error("Error Response:",(D=c.response)==null?void 0:D.data),d({visible:!0,type:"danger",message:(L=(S=c.response)==null?void 0:S.data)!=null&&L.errors?Object.values(c.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return n.useEffect(()=>{if(i.visible){const a=setTimeout(()=>d({...i,visible:!1}),3e3);return()=>clearTimeout(a)}},[i]),E==="loading"?e.jsx("div",{children:"Loading..."}):e.jsx(q,{children:e.jsx(v,{xs:12,children:e.jsxs(w,{children:[e.jsx(B,{children:e.jsx("strong",{children:"Leave Request"})}),e.jsxs(I,{children:[i.visible&&e.jsx(k,{color:i.type,dismissible:!0,children:i.message}),e.jsxs(A,{onSubmit:N,children:[e.jsxs(P,{label:"Leave Type",value:m,onChange:a=>g(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation Leave",children:"Vacation Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"}),e.jsx("option",{value:"Maternity Leave",children:"Maternity Leave"}),e.jsx("option",{value:"Calamity Leave",children:"Calamity Leave"}),e.jsx("option",{value:"Bereavement Leave",children:"Bereavement Leave"})]}),s.leaveType&&e.jsx("span",{className:"text-danger",children:s.leaveType}),e.jsx("br",{}),e.jsxs(q,{children:[e.jsxs(v,{className:"mb-3",children:[e.jsx(x,{type:"date",label:"Start Date",value:o,onChange:a=>j(a.target.value),required:!0}),s.startDate&&e.jsx("span",{className:"text-danger",children:s.startDate})]}),e.jsxs(v,{className:"mb-3",children:[e.jsx(x,{type:"date",label:"End Date",value:l,onChange:a=>h(a.target.value),required:!0}),s.endDate&&e.jsx("span",{className:"text-danger",children:s.endDate})]})]}),e.jsx(V,{label:"Reason",value:p,onChange:a=>f(a.target.value),required:!0}),s.reason&&e.jsx("span",{className:"text-danger",children:s.reason}),e.jsx("br",{}),e.jsx(x,{type:"file",label:"Upload Document",onChange:T,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg"}),e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Notice:"})," Please combine multiple files or images into a single PDF before uploading."]}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(M,{type:"submit",color:"primary",children:"Submit Request"})]})]})]})})})};export{Z as default};
