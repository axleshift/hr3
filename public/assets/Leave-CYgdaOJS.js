import{k as N,r,i as w,j as e}from"./index-CCQjMedi.js";import{g as v,e as q,a as I}from"./api-DtbWpsV7.js";import{C as T,a as y}from"./CRow-DNMWGK06.js";import{C as k,a as A}from"./CCardBody-CfIUcbl0.js";import{C as B}from"./CCardHeader-DSNy9un6.js";import{a as O,C as V}from"./CForm-KFIMHm5K.js";import{C as M}from"./CFormSelect-Ba8ZMqlB.js";import{C as g}from"./CFormInput-BrW2xO6p.js";import{C as U}from"./CFormTextarea-DeHnIjIH.js";import"./CFormControlWrapper-WmVgiADm.js";const H=()=>{const l=N(),[p,n]=r.useState("loading"),m=async a=>{try{const c=await q.post("/auth/verify-session",{session_id:a});l({type:"SET_USER",payload:c.data.user}),l({type:"SET_SESSION_ID",payload:a}),n("authenticated")}catch{v.get("dcims")&&v.remove("dcims"),n("unauthenticated")}};return r.useEffect(()=>{const a=v.get("dcims");a?m(a):n("unauthenticated")},[v.get("dcims")]),p},Z=()=>{const[l,p]=r.useState(""),[n,m]=r.useState(""),[a,c]=r.useState(""),[h,f]=r.useState(""),[j,C]=r.useState(null),[i,S]=r.useState({}),[d,x]=r.useState({visible:!1,type:"",message:""});w();const R=H(),b={employee_id:sessionStorage.getItem("employee_id")||"",name:sessionStorage.getItem("name")||""},F=t=>{const s=t.target.files[0];s&&C(s)},_=async t=>{var D,L,E;t.preventDefault();const s={};if(l.trim()||(s.leaveType="Leave Type is required"),n.trim()||(s.startDate="Start Date is required"),a.trim()?new Date(n)>new Date(a)&&(s.endDate="End Date must be after Start Date"):s.endDate="End Date is required",h.trim()||(s.reason="Reason is required"),Object.keys(s).length>0){S(s);return}S({});const o=new FormData;o.append("employee_id",b.employee_id),o.append("name",b.name),o.append("leave_type",l),o.append("start_date",n),o.append("end_date",a),o.append("reason",h),j&&o.append("document",j);try{const u=await q.post("/leave-request",o,{headers:{"Content-Type":"multipart/form-data"}});console.log("Response:",u.data),x({visible:!0,type:"success",message:"Leave request submitted successfully!"}),p(""),m(""),c(""),f(""),C(null)}catch(u){console.error("Error Response:",(D=u.response)==null?void 0:D.data),x({visible:!0,type:"danger",message:(E=(L=u.response)==null?void 0:L.data)!=null&&E.errors?Object.values(u.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return r.useEffect(()=>{if(d.visible){const t=setTimeout(()=>x({...d,visible:!1}),3e3);return()=>clearTimeout(t)}},[d]),R==="loading"?e.jsx("div",{children:"Loading..."}):e.jsx(T,{children:e.jsx(y,{xs:12,children:e.jsxs(k,{children:[e.jsx(B,{children:e.jsx("strong",{children:"Leave Request"})}),e.jsxs(A,{children:[d.visible&&e.jsx(O,{color:d.type,dismissible:!0,children:d.message}),e.jsxs(V,{onSubmit:_,children:[e.jsxs(M,{label:"Leave Type",value:l,onChange:t=>p(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation Leave",children:"Vacation Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"}),e.jsx("option",{value:"Maternity Leave",children:"Maternity Leave"}),e.jsx("option",{value:"Calamity Leave",children:"Calamity Leave"}),e.jsx("option",{value:"Bereavement Leave",children:"Bereavement Leave"})]}),i.leaveType&&e.jsx("span",{className:"text-danger",children:i.leaveType}),e.jsx("br",{}),e.jsxs(T,{children:[e.jsxs(y,{className:"mb-3",children:[e.jsx(g,{type:"date",label:"Start Date",value:n,onChange:t=>m(t.target.value),required:!0}),i.startDate&&e.jsx("span",{className:"text-danger",children:i.startDate})]}),e.jsxs(y,{className:"mb-3",children:[e.jsx(g,{type:"date",label:"End Date",value:a,onChange:t=>c(t.target.value),required:!0}),i.endDate&&e.jsx("span",{className:"text-danger",children:i.endDate})]})]}),e.jsx(U,{label:"Reason",value:h,onChange:t=>f(t.target.value),required:!0}),i.reason&&e.jsx("span",{className:"text-danger",children:i.reason}),e.jsx("br",{}),e.jsx(g,{type:"file",label:"Upload Document",onChange:F,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg"}),e.jsx("br",{}),e.jsx(I,{type:"submit",color:"primary",children:"Submit Request"})]})]})]})})})};export{Z as default};
