import{r as o,j as e,C as k,R as B,m as d}from"./index-CbFWoaI5.js";import{a as g,F as E,D as U}from"./index-BoNXW8A9.js";import{C as _,a as A}from"./CCardBody-Fxq8QZEm.js";import{C as q}from"./CCardHeader-CdD6i7wQ.js";import{C as f}from"./CFormSelect-CgMgLtRD.js";import{C as H}from"./CAlert-C06U3ob5.js";import{C as I,a as Y,b as i,c as n,d as $,e as r}from"./CTable-BEmur1Om.js";import{C as x}from"./DefaultLayout-BTVvInV6.js";import"./CFormControlWrapper-UpGAhbY9.js";const Z=()=>{const[h,y]=o.useState([]),[M,C]=o.useState([]),[l,w]=o.useState(new Date().getFullYear()),[c,b]=o.useState(new Date().getMonth()+1),[v,p]=o.useState(!1),[j,u]=o.useState(null),D=Array.from({length:new Date().getFullYear()-2020+1},(t,s)=>2020+s),N=async()=>{try{p(!0),u(null);const t=l&&c?{year:l,month:c}:{},[s,a]=await Promise.all([d.get("/leave-requests/page",{params:t}),d.get("/leave-types")]);y(s.data.leaveRequests||s.data),C(a.data),calculateLeaveBalances(s.data.leaveRequests||s.data,a.data)}catch(t){u("Error fetching leave data."),console.error(t)}finally{p(!1)}};o.useEffect(()=>{N()},[l,c]);const S=t=>t.reduce((s,a)=>{const m=a.department||"Unassigned";return s[m]||(s[m]=[]),s[m].push(a),s},{}),R=async()=>{try{const t=await d.get("/generate-report",{params:{year:l,month:c},responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=s,a.setAttribute("download",`leave-report-${l}-${c}.pdf`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)}catch(t){console.error("Error downloading PDF:",t),alert("Failed to download the PDF. Please try again.")}},L=()=>{const t=new URLSearchParams({year:l,month:c}).toString();window.open(`${d.defaults.baseURL}/view-report?${t}`,"_blank")},F=t=>{let s;switch(t){case"Approved":s="success";break;case"Rejected":s="danger";break;default:s="warning"}return e.jsx(x,{color:s,children:t})},P=t=>t==="Paid"?e.jsx(x,{color:"success",children:"Paid"}):e.jsx(x,{color:"secondary",children:"Unpaid"}),T={fontWeight:"bold",fontSize:"1.1em",padding:"10px",backgroundColor:"#f0f0f0"};return e.jsx("div",{children:e.jsxs(_,{className:"mb-4",children:[e.jsxs(q,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Leave Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(f,{value:c,onChange:t=>b(parseInt(t.target.value)),style:{width:"120px"},children:Array.from({length:12},(t,s)=>{const a=s+1;return e.jsx("option",{value:a,children:new Date(2e3,s).toLocaleString("default",{month:"long"})},a)})}),e.jsx(f,{value:l,onChange:t=>w(parseInt(t.target.value)),style:{width:"90px"},children:D.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs(g,{color:"danger",onClick:R,children:[e.jsx(E,{icon:U})," Export PDF"]}),e.jsxs(g,{color:"info",onClick:L,className:"ms-2",children:[" ","View PDF"]})]})]}),e.jsxs(A,{children:[j&&e.jsx(H,{color:"danger",children:j}),v?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(k,{color:"primary"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(I,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(i,{children:[e.jsx(n,{children:"Employee"}),e.jsx(n,{className:"text-center",children:"Department"}),e.jsx(n,{className:"text-center",children:"Leave Type"}),e.jsx(n,{className:"text-center",children:"Duration"}),e.jsx(n,{className:"text-center",children:"Days"}),e.jsx(n,{className:"text-center",children:"Status"}),e.jsx(n,{className:"text-center",children:"Paid"}),e.jsx(n,{className:"text-center",children:"Reason"})]})}),e.jsx($,{children:h.length>0?Object.entries(S(h)).map(([t,s])=>e.jsxs(B.Fragment,{children:[e.jsx(i,{children:e.jsx(r,{colSpan:"8",style:T,children:e.jsxs("strong",{children:[t," Department"]})})}),s.map(a=>e.jsxs(i,{children:[e.jsx(r,{children:a.name}),e.jsx(r,{className:"text-center",children:a.department}),e.jsx(r,{className:"text-center",children:a.leave_type}),e.jsxs(r,{className:"text-center",children:[new Date(a.start_date).toLocaleDateString()," -"," ",new Date(a.end_date).toLocaleDateString()]}),e.jsx(r,{className:"text-center",children:a.total_days}),e.jsx(r,{className:"text-center",children:F(a.status)}),e.jsx(r,{className:"text-center",children:P(a.is_paid)}),e.jsx(r,{className:"text-center",children:a.reason})]},a.id))]},t)):e.jsx(i,{children:e.jsx(r,{colSpan:"8",className:"text-center",children:"No leave data available for the selected period"})})})]})})})]})]})})};export{Z as default};
