import{r as a,_ as S,R as p,d as x,e as B,P as r,f as X,h as U,j as s,a as q}from"./index-BAyO2E5M.js";import{C as z,a as P}from"./CRow-jB5mWDoF.js";import{C as Z,a as $}from"./CCardBody-DE_qiR2I.js";import{C as _}from"./CCardHeader-DgjXZTh6.js";import{C as G}from"./CFormSelect-B8keXU-z.js";import{u as ee,T as se,q as J,b as te}from"./Compliance-CmyZk0Sd.js";import{C as ne,a as ae,b as A,c as H,d as re,e as D}from"./CTable-CZKmf_kd.js";import{f as oe}from"./DefaultLayout-Bxecxb4e.js";import"./CFormControlWrapper-CVzywb50.js";var Q=a.createContext({}),M=a.forwardRef(function(e,d){var m=e.children,l=e.animation,t=l===void 0?!0:l,i=e.autohide,C=i===void 0?!0:i,h=e.className,y=e.color,f=e.delay,g=f===void 0?5e3:f,c=e.index,v=e.innerKey,w=e.visible,b=w===void 0?!1:w,N=e.onClose,T=e.onShow,F=S(e,["children","animation","autohide","className","color","delay","index","innerKey","visible","onClose","onShow"]),n=a.useRef(),o=ee(d,n),E=a.useState(!1),u=E[0],k=E[1],R=a.useRef();a.useEffect(function(){k(b)},[b]);var W={visible:u,setVisible:k};a.useEffect(function(){return function(){return clearTimeout(R.current)}},[]),a.useEffect(function(){I()},[u]);var I=function(){C&&(clearTimeout(R.current),R.current=window.setTimeout(function(){k(!1)},g))};return p.createElement(se,{in:u,nodeRef:n,onEnter:function(){return T&&T(c??null)},onExited:function(){return N&&N(c??null)},timeout:250,unmountOnExit:!0},function(L){var j;return p.createElement(Q.Provider,{value:W},p.createElement("div",x({className:B("toast",(j={fade:t},j["bg-".concat(y)]=y,j["border-0"]=y,j["show showing"]=L==="entering"||L==="exiting",j.show=L==="entered",j),h),"aria-live":"assertive","aria-atomic":"true",role:"alert",onMouseEnter:function(){return clearTimeout(R.current)},onMouseLeave:function(){return I()}},F,{key:v,ref:o}),m))})});M.propTypes={animation:r.bool,autohide:r.bool,children:r.node,className:r.string,color:X,delay:r.number,index:r.number,innerKey:r.oneOfType([r.number,r.string]),onClose:r.func,onShow:r.func,visible:r.bool};M.displayName="CToast";var K=a.forwardRef(function(e,d){var m=e.children,l=e.className,t=S(e,["children","className"]);return p.createElement("div",x({className:B("toast-body",l)},t,{ref:d}),m)});K.propTypes={children:r.node,className:r.string};K.displayName="CToastBody";var V=a.forwardRef(function(e,d){var m=e.children,l=e.as,t=S(e,["children","as"]),i=a.useContext(Q).setVisible;return l?p.createElement(l,x({onClick:function(){return i(!1)}},t,{ref:d}),m):p.createElement(J,x({onClick:function(){return i(!1)}},t,{ref:d}))});V.propTypes=x(x({},J.propTypes),{as:r.elementType});V.displayName="CToastClose";var O=a.forwardRef(function(e,d){var m=e.children,l=e.className,t=e.closeButton,i=S(e,["children","className","closeButton"]);return p.createElement("div",x({className:B("toast-header",l)},i,{ref:d}),m,t&&p.createElement(V,null))});O.propTypes={children:r.node,className:r.string,closeButton:r.bool};O.displayName="CToastHeader";var Y=a.forwardRef(function(e,d){var m=e.children,l=e.className,t=e.placement,i=e.push,C=S(e,["children","className","placement","push"]),h=a.useState([]),y=h[0],f=h[1],g=a.useRef(0);a.useEffect(function(){g.current++,i&&c(i)},[i]);var c=function(v){f(function(w){return U(U([],w,!0),[p.cloneElement(v,{index:g.current,innerKey:g.current,onClose:function(b){return f(function(N){return N.filter(function(T){return T.props.index!==b})})}})],!1)})};return p.createElement(oe,{portal:typeof t=="string"},y.length>0||m?p.createElement("div",x({className:B("toaster toast-container",{"position-fixed":t,"top-0":t&&t.includes("top"),"top-50 translate-middle-y":t&&t.includes("middle"),"bottom-0":t&&t.includes("bottom"),"start-0":t&&t.includes("start"),"start-50 translate-middle-x":t&&t.includes("center"),"end-0":t&&t.includes("end")},l)},C,{ref:d}),m,y.map(function(v){return p.cloneElement(v,{visible:!0})})):null)});Y.propTypes={children:r.node,className:r.string,placement:r.oneOfType([r.string,r.oneOf(["top-start","top-center","top-end","middle-start","middle-center","middle-end","bottom-start","bottom-center","bottom-end"])]),push:r.any};Y.displayName="CToaster";const ye=()=>{const[e,d]=a.useState([]),[m,l]=a.useState(!1),[t,i]=a.useState(null),[C,h]=a.useState(null),y=a.useRef(null),[f,g]=a.useState(new Date().getMonth()+1),[c,v]=a.useState(new Date().getFullYear()),[w,b]=a.useState(new Date().toLocaleString("default",{month:"long"}));a.useEffect(()=>{(async()=>{try{l(!0);const o=await q.get("/api/payroll",{params:{year:c,month:f}});d(Array.isArray(o.data)?o.data:[])}catch(o){console.error("Error fetching payslips:",o),i("Failed to fetch payslips"),h({message:"Failed to fetch payslips",color:"danger"}),d([])}finally{l(!1)}})()},[c,f]),a.useEffect(()=>{const n=new Date(c,f-1).toLocaleString("default",{month:"long"});b(n)},[f,c]);const N=async()=>{var n,o,E;l(!0),i(null);try{const u=await q.post("/api/release",{month:f,year:c});console.log("Release Payslips Response:",u.data),u.data.message==="All payslips for this month have already been released."?h({message:u.data.message,color:"info"}):(d(u.data.data||[]),h({message:"Payslips released successfully for all employees!",color:"success"}))}catch(u){console.error("Error releasing payslips:",u),console.error("Error details:",((n=u.response)==null?void 0:n.data)||u.message),i("Failed to release payslips"),h({message:((E=(o=u.response)==null?void 0:o.data)==null?void 0:E.message)||"Failed to release payslips",color:"danger"}),console.error("Full error response:",u.response)}finally{l(!1)}},T=Array.from({length:new Date().getFullYear()-2020+1},(n,o)=>2020+o),F=n=>{if(!n)return"Invalid Date";const o=new Date(n);return isNaN(o.getTime())?"Invalid Date":o.toLocaleDateString()};return s.jsxs(z,{children:[s.jsx(P,{xs:12,children:s.jsxs(Z,{className:"mb-4",children:[s.jsx(_,{children:s.jsx("strong",{children:"Payslip"})}),s.jsxs($,{children:[t&&s.jsx("p",{style:{color:"red"},children:t}),s.jsxs(z,{className:"mb-3 align-items-center",children:[s.jsx(P,{xs:12,md:3,className:"mb-2 mb-md-0",children:s.jsx(G,{value:f,onChange:n=>g(Number(n.target.value)),style:{width:"100%"},className:"custom-select",children:Array.from({length:12},(n,o)=>s.jsx("option",{value:o+1,children:new Date(2023,o).toLocaleString("default",{month:"long"})},o+1))})}),s.jsx(P,{xs:12,md:3,className:"mb-2 mb-md-0",children:s.jsx(G,{value:c,onChange:n=>v(Number(n.target.value)),style:{width:"100%"},className:"custom-select",children:T.map(n=>s.jsx("option",{value:n,children:n},n))})}),s.jsx(P,{xs:12,md:6,className:"text-md-start text-center",children:s.jsx(te,{color:"success",onClick:N,disabled:m,children:m?"Processing...":"Send Payslips"})})]}),s.jsxs(ne,{striped:!0,hover:!0,responsive:!0,children:[s.jsx(ae,{children:s.jsxs(A,{children:[s.jsx(H,{children:"Employee Name"}),s.jsx(H,{children:"Net Salary"}),s.jsx(H,{children:"Date Issued"})]})}),s.jsx(re,{children:(e||[]).length>0?e.map(n=>s.jsxs(A,{children:[s.jsx(D,{children:n.name||"Unknown"}),s.jsx(D,{children:parseFloat(n.net_salary||0).toLocaleString("en-US",{style:"currency",currency:"PHP",minimumFractionDigits:2})}),s.jsx(D,{children:F(n.created_at)})]},n.id)):s.jsx(A,{children:s.jsx(D,{colSpan:"3",className:"text-center",children:"No payslips available"})})})]})]})]})}),s.jsx(Y,{ref:y,placement:"top-end",children:C&&s.jsxs(M,{autohide:!0,delay:3e3,show:!0,color:C.color,onClose:()=>h(null),children:[s.jsx(O,{closeButton:!0,children:s.jsx("strong",{className:"me-auto",children:"Notification"})}),s.jsx(K,{children:C.message})]})})]})};export{ye as default};
