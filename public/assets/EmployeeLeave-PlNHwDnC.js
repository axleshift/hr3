import{r as a,m as b,j as e,C as se}from"./index-WrjKmXgs.js";import{a as h,F as ae,G as te}from"./index-BMI0ZrrN.js";import{C as re,a as ne}from"./CCardBody-DanWnfWG.js";import{C as le}from"./CCardHeader-D-SmzBl0.js";import{C as U}from"./CAlert-B1XC_8we.js";import{C as ie,a as oe,b as D,c as u,d as de,e as d}from"./CTable-DvXfHdoe.js";import{C as V}from"./DefaultLayout-kwK9HI32.js";import{C as O,a as G,b as $,c as z}from"./CModalTitle-BBkb4HVW.js";import{C as ce}from"./CForm-CCWVO9dE.js";import{C as ue}from"./CFormSelect-C9Jitwj-.js";import{C as pe,a as J}from"./CRow-C_OWrLVj.js";import{C as S}from"./CFormInput-7sO-1vcx.js";import{C as me}from"./CFormTextarea-Bjj13Vjy.js";import{C as K}from"./CModalFooter-BtHS1zTr.js";import"./CFormControlWrapper-_JJkpmBa.js";const Ne=()=>{const[L,Q]=a.useState([]),[W,j]=a.useState(!0),[T,q]=a.useState(null),[X,F]=a.useState(!1),[g,N]=a.useState(""),[p,R]=a.useState(""),[m,w]=a.useState(""),[v,E]=a.useState(""),[_,A]=a.useState(null),[n,M]=a.useState({}),[r,c]=a.useState({visible:!1,type:"",message:""}),[i,f]=a.useState(null),[C,y]=a.useState([]),o=sessionStorage.getItem("user_id");a.useEffect(()=>{if(r.visible){const s=setTimeout(()=>c({...r,visible:!1}),3e3);return()=>clearTimeout(s)}},[r]),a.useEffect(()=>{if(!o){q("User ID not found. Please log in again."),j(!1);return}P(),Y()},[o]);const P=a.useCallback(async()=>{try{j(!0);const s=await b.get(`/api/leave/${o}`);Q(s.data.leaveRequests||[])}catch{q("Failed to load leave requests. Please try again later.")}finally{j(!1)}},[o]),Y=a.useCallback(async()=>{try{const s=await b.get("/api/leave-types");console.log("Leave types response:",s.data),s.data&&Array.isArray(s.data)?y(s.data):(console.error("Leave types data is not an array:",s.data),y([]))}catch(s){console.error("Error fetching leave types:",s),c({visible:!0,type:"danger",message:"Failed to load leave types. Please try again later."}),y([])}},[]),k=s=>{switch(s){case"Pending":return"warning";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},Z=s=>{const t=s.target.files[0];t&&A(t)},ee=async s=>{var B,H,I;if(s.preventDefault(),!o||isNaN(o)){c({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}const t={};if(g.trim()||(t.leaveType="Leave Type is required"),p.trim()||(t.startDate="Start Date is required"),m.trim()?new Date(p)>new Date(m)&&(t.endDate="End Date must be after Start Date"):t.endDate="End Date is required",v.trim()||(t.reason="Reason is required"),Object.keys(t).length>0){M(t);return}M({});const l=new FormData;l.append("user_id",o),l.append("name",sessionStorage.getItem("name")||""),l.append("leave_type",g),l.append("start_date",p),l.append("end_date",m),l.append("reason",v),_&&l.append("document",_);try{const x=await b.post("/api/leave-requests",l,{headers:{"Content-Type":"multipart/form-data"}});c({visible:!0,type:"success",message:"Leave request submitted successfully!"}),N(""),R(""),w(""),E(""),A(null),P()}catch(x){console.error("Error Response:",(B=x.response)==null?void 0:B.data),c({visible:!0,type:"danger",message:(I=(H=x.response)==null?void 0:H.data)!=null&&I.errors?Object.values(x.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return e.jsxs(re,{children:[e.jsxs(le,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"My Leave Requests"}),e.jsx(h,{className:"float-end",color:"primary",onClick:()=>F(!0),children:"Request Leave"})]}),e.jsx(ne,{children:W?e.jsxs("div",{className:"text-center",children:[e.jsx(se,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):T?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:T})}):e.jsxs(e.Fragment,{children:[r.visible&&e.jsx(U,{color:r.type,dismissible:!0,children:r.message}),e.jsxs(ie,{hover:!0,responsive:!0,children:[e.jsx(oe,{children:e.jsxs(D,{className:"text-center",children:[e.jsx(u,{children:"#"}),e.jsx(u,{children:"Leave Type"}),e.jsx(u,{children:"Date Requested"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(de,{className:"text-center",children:L.length===0?e.jsx(D,{children:e.jsx(d,{colSpan:"5",className:"text-center",children:"No leave requests available."})}):L.map((s,t)=>e.jsxs(D,{children:[e.jsx(d,{children:t+1}),e.jsx(d,{children:s.leave_type}),e.jsx(d,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(d,{children:e.jsx(V,{color:k(s.status),children:s.status})}),e.jsx(d,{children:e.jsx(h,{color:"info",component:"span",onClick:()=>f(s),children:e.jsx(ae,{icon:te})})})]},s.id))})]})]})}),e.jsxs(O,{visible:X,onClose:()=>F(!1),children:[e.jsx(G,{children:e.jsx($,{children:"Leave Request"})}),e.jsxs(z,{children:[r.visible&&e.jsx(U,{color:r.type,dismissible:!0,children:r.message}),e.jsxs(ce,{onSubmit:ee,id:"leaveForm",children:[e.jsxs(ue,{label:"Leave Type",value:g,onChange:s=>N(s.target.value),required:!0,disabled:C.length===0,children:[e.jsx("option",{value:"",children:C.length===0?"Loading leave types...":"Select Leave Type"}),C.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),n.leaveType&&e.jsx("span",{className:"text-danger",children:n.leaveType}),e.jsx("br",{}),e.jsxs(pe,{children:[e.jsxs(J,{className:"mb-3",children:[e.jsx(S,{type:"date",label:"Start Date",value:p,onChange:s=>R(s.target.value),required:!0}),n.startDate&&e.jsx("span",{className:"text-danger",children:n.startDate})]}),e.jsxs(J,{className:"mb-3",children:[e.jsx(S,{type:"date",label:"End Date",value:m,onChange:s=>w(s.target.value),required:!0}),n.endDate&&e.jsx("span",{className:"text-danger",children:n.endDate})]})]}),e.jsx(me,{label:"Reason",value:v,onChange:s=>E(s.target.value),required:!0}),n.reason&&e.jsx("span",{className:"text-danger",children:n.reason}),e.jsx("br",{}),e.jsx(S,{type:"file",label:"Upload Document",onChange:Z,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg"}),e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Notice:"})," Please combine multiple files or images into a single PDF before uploading."]}),e.jsx("br",{}),e.jsx("br",{})]})]}),e.jsx(K,{children:e.jsx(h,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]}),e.jsxs(O,{visible:!!i,onClose:()=>f(null),children:[e.jsx(G,{children:e.jsx($,{children:"Leave Details"})}),e.jsx(z,{children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Leave Type:"})," ",i.leave_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",i.reason]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Requested:"})," ",new Date(i.created_at).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(V,{color:k(i.status),children:i.status})]})]})}),e.jsx(K,{children:e.jsx(h,{color:"secondary",onClick:()=>f(null),children:"Close"})})]})]})};export{Ne as default};
