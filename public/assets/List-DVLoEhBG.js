import{r as a,a as C,j as e,C as re}from"./index-BAyO2E5M.js";import{F as y,r as ne,b as v,p as le,s as oe}from"./Compliance-CmyZk0Sd.js";import{C as ce,a as ie}from"./CCardBody-DE_qiR2I.js";import{C as de}from"./CCardHeader-DgjXZTh6.js";import{C as F}from"./CFormSelect-B8keXU-z.js";import{C as he}from"./CInputGroup-Dq7iEPPL.js";import{C as xe}from"./CFormInput-B4GftH-Q.js";import{C as je}from"./CInputGroupText-Cxlec9us.js";import{C as T,a as q,b as p,c as r,d as H,e as n}from"./CTable-CZKmf_kd.js";import{C as S}from"./DefaultLayout-Bxecxb4e.js";import{C as pe,a as D}from"./CPaginationItem-DN8gZ5uQ.js";import{C as I,a as P,b as k,c as A}from"./CModalTitle-BFzPY1rf.js";import{C as me}from"./CModalFooter-_jnTenoP.js";import"./CFormControlWrapper-CVzywb50.js";const Ne=()=>{const[w,L]=a.useState([]),[b,h]=a.useState([]),[B,_]=a.useState(!0),[$,Y]=a.useState(""),[c,m]=a.useState(1),[R,V]=a.useState(1),[x,z]=a.useState(null),[l,E]=a.useState(null),[G,u]=a.useState(!1),[Q,N]=a.useState(!1),[g,U]=a.useState(new Date().getMonth()+1),[j,J]=a.useState(new Date().getFullYear()),M=10;a.useEffect(()=>{K()},[c,g,j]);const K=async()=>{try{_(!0);const t=(await C.get("/api/leave-requests/page",{params:{page:c,limit:M,year:j}})).data||{};if(Array.isArray(t.leaveRequests)){const o=t.leaveRequests.filter(i=>{const d=new Date(i.start_date);return d.getMonth()+1===g&&d.getFullYear()===j});L(o),h(o)}else L([]),h([]);V(t.totalPages||1)}catch(s){console.error("Error fetching leave list:",s)}finally{_(!1)}},O=s=>{if(Y(s),s.trim()==="")h(w);else{const t=w.filter(o=>o.name.toLowerCase().includes(s.trim().toLowerCase()));h(t)}},f=s=>{if(!s||typeof s!="string")return"primary";switch(String(s).toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"primary"}},W=async(s,t)=>{try{const i=(await C.get(`/api/leaves/${s}`)).data.leaveRequests||[],d=i.length>0?i[0].department:"Unknown";z({name:t,department:d,leaveHistory:i}),u(!0)}catch(o){console.error("Error fetching employee info:",o)}},X=async s=>{try{const t=await C.get(`/api/leave-requests/${s}`);t.data.leaveRequests&&t.data.leaveRequests.length>0?E(t.data.leaveRequests[0]):E(null),N(!0)}catch(t){console.error("Error fetching leave details:",t)}},Z=(s,t)=>{const o=new Date(s),i=new Date(t),d=o.getMonth()+1,se=o.getDate(),te=i.getDate(),ae=o.getFullYear().toString().slice(-2);return`${d}/${se}-${te}/${ae}`},ee=Array.from({length:new Date().getFullYear()-2020+1},(s,t)=>2020+t);return e.jsxs(ce,{children:[e.jsxs(de,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Leave List"}),e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsx(F,{value:g,onChange:s=>U(Number(s.target.value)),style:{width:"120px",marginRight:"10px"},children:Array.from({length:12},(s,t)=>e.jsx("option",{value:t+1,children:new Date(2023,t).toLocaleString("default",{month:"long"})},t+1))}),e.jsx(F,{value:j,onChange:s=>J(parseInt(s.target.value)),style:{width:"90px",marginRight:"10px"},children:ee.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(he,{style:{width:"150px"},children:[e.jsx(xe,{type:"text",placeholder:"Search...",value:$,onChange:s=>O(s.target.value)}),e.jsx(je,{color:"primary",children:e.jsx(y,{icon:ne})})]})]})]}),e.jsx(ie,{children:B?e.jsxs("div",{className:"text-center",children:[e.jsx(re,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):b.length===0?e.jsx("div",{className:"text-center",children:e.jsx("p",{children:"No leave request found."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(T,{hover:!0,responsive:!0,children:[e.jsx(q,{children:e.jsxs(p,{children:[e.jsx(r,{children:"#"}),e.jsx(r,{children:"Employee"}),e.jsx(r,{children:"Date Requested"}),e.jsx(r,{children:"Leave Type"}),e.jsx(r,{children:"Days"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Actions"})]})}),e.jsx(H,{children:b.map((s,t)=>e.jsxs(p,{children:[e.jsx(n,{children:(c-1)*M+t+1}),e.jsx(n,{children:s.name}),e.jsx(n,{children:new Date(s.updated_at).toLocaleDateString()}),e.jsx(n,{children:s.leave_type}),e.jsx(n,{children:s.total_days}),e.jsx(n,{children:e.jsx(S,{color:f(s.status),children:s.status})}),e.jsxs(n,{children:[e.jsx(v,{color:"info",size:"sm",onClick:()=>W(s.user_id,s.name),className:"me-2",children:e.jsx(y,{icon:le})}),e.jsx(v,{color:"primary",size:"sm",onClick:()=>X(s.id),children:e.jsx(y,{icon:oe})})]})]},s.id))})]})}),e.jsxs(pe,{align:"center",className:"mt-3",children:[e.jsx(D,{disabled:c===1,onClick:()=>m(c-1),children:"«"}),Array.from({length:R},(s,t)=>e.jsx(D,{active:t+1===c,onClick:()=>m(t+1),children:t+1},t+1)),e.jsx(D,{disabled:c===R,onClick:()=>m(c+1),children:"»"})]})]})}),e.jsxs(I,{visible:G,onClose:()=>u(!1),children:[e.jsx(P,{children:e.jsx(k,{children:"Employee Information"})}),e.jsx(A,{children:x?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",x.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Department:"})," ",x.department]}),e.jsx("p",{children:e.jsx("strong",{children:"Leave History:"})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(T,{hover:!0,responsive:!0,children:[e.jsx(q,{children:e.jsxs(p,{children:[e.jsx(r,{children:"#"}),e.jsx(r,{children:"Leave Type"}),e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Days"})]})}),e.jsx(H,{children:x.leaveHistory.map((s,t)=>e.jsxs(p,{children:[e.jsx(n,{children:t+1}),e.jsx(n,{children:s.leave_type}),e.jsx(n,{children:Z(s.start_date,s.end_date)}),e.jsx(n,{children:s.total_days}),e.jsx(n,{children:e.jsx(S,{color:f(s.status),children:s.status})})]},s.id))})]})})]}):e.jsx("p",{children:"No employee data found."})}),e.jsx(me,{children:e.jsx(v,{color:"secondary",onClick:()=>u(!1),children:"Close"})})]}),e.jsxs(I,{visible:Q,onClose:()=>N(!1),children:[e.jsx(P,{closeButton:!0,children:e.jsx(k,{children:"Leave Request Details"})}),e.jsx(A,{children:l?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",l.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Leave Type:"})," ",l.leave_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Start to End Date:"})," ",new Date(l.start_date).toLocaleDateString()," -"," ",new Date(l.end_date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Days:"})," ",l.total_days]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(S,{color:f(l.status),children:l.status})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",l.reason]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Document:"})," ",l.document_path?e.jsx("a",{href:`http://localhost:8000/storage/${l.document_path}`,target:"_blank",rel:"noopener noreferrer",children:"View Document"}):"No document uploaded"]})]})}):e.jsx("p",{children:"No leave details found."})})]})]})};export{Ne as default};
