import{r as d,j as e,C as S,R as A,a as v}from"./index-D5jCKoxG.js";import{b as F,F as D,m as B,n as U}from"./Compliance-BrJnQCr2.js";import{C as H,a as O}from"./CCardBody-BXocfgBq.js";import{C as I}from"./CCardHeader-Bqc1h0_P.js";import{C as T}from"./CFormSelect-CTqTi1AW.js";import{C as Y}from"./CAlert-DUfFKTLr.js";import{C as $,a as M,b as i,c as l,d as z,e as n,f as W}from"./CTable-BGZJ4gYh.js";import"./CFormControlWrapper-Bkm-FHdO.js";const ee=()=>{const[c,f]=d.useState([]),[p,N]=d.useState(new Date().getFullYear()),[x,P]=d.useState(new Date().getMonth()+1),[h,g]=d.useState(!1),[m,j]=d.useState(null),[y,b]=d.useState(!1),E=Array.from({length:new Date().getFullYear()-2020+1},(r,a)=>2020+a),C=async()=>{var r,a;try{g(!0),j(null);const s=await v.get("/api/payroll",{params:{year:p,month:x},withCredentials:!0}),t=s.data.payroll||s.data;if(Array.isArray(t))f(t);else throw new Error("Invalid payroll data format received from server")}catch(s){console.error("Error fetching payroll data:",s),j(((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||s.message||"Failed to fetch payroll data"),f([])}finally{g(!1)}};d.useEffect(()=>{C()},[p,x]);const L=()=>c.reduce((r,a)=>r+parseFloat(a.net_salary||0),0),o=r=>parseFloat(r||0).toLocaleString("en-US",{style:"currency",currency:"PHP",minimumFractionDigits:2}),w=r=>r.reduce((a,s)=>{const t=s.department||"Unassigned";return a[t]||(a[t]=[]),a[t].push(s),a},{}),R=async()=>{try{b(!0);const r=await v.get("/api/payroll/download-report",{params:{year:p,month:x},responseType:"blob",withCredentials:!0}),a=window.URL.createObjectURL(new Blob([r.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",`payroll-report-${p}-${x}.pdf`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(r){console.error("Error downloading PDF:",r),j("Failed to download the PDF. Please try again.")}finally{b(!1)}},_={backgroundColor:"#f8f9fa",fontWeight:"bold",fontSize:"1.1em",padding:"10px"},k={backgroundColor:"#e9ecef",fontWeight:"bold"};return e.jsx("div",{children:e.jsxs(H,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Payroll Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(T,{value:x,onChange:r=>P(parseInt(r.target.value)),style:{width:"120px"},disabled:h,children:Array.from({length:12},(r,a)=>e.jsx("option",{value:a+1,children:new Date(2023,a).toLocaleString("default",{month:"long"})},a+1))}),e.jsx(T,{value:p,onChange:r=>N(parseInt(r.target.value)),style:{width:"90px"},disabled:h,children:E.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx(F,{color:"secondary",onClick:C,disabled:h,children:e.jsx(D,{icon:B,spin:h})}),e.jsx(F,{color:"primary",onClick:R,disabled:y||h||c.length===0,children:y?e.jsx(S,{size:"sm"}):e.jsx(D,{icon:U})})]})]}),e.jsxs(O,{children:[m&&e.jsx(Y,{color:"danger",dismissible:!0,onClose:()=>j(null),children:m}),h?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(S,{}),e.jsx("p",{children:"Loading payroll data..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs($,{hover:!0,bordered:!0,responsive:!0,children:[e.jsx(M,{children:e.jsxs(i,{children:[e.jsx(l,{children:"Employee Name"}),e.jsx(l,{children:"Department"}),e.jsx(l,{children:"Base Salary"}),e.jsx(l,{children:"Overtime"}),e.jsx(l,{children:"Bonus"}),e.jsx(l,{children:"Benefits"}),e.jsx(l,{children:"Deductions"}),e.jsx(l,{children:"Net Salary"})]})}),e.jsx(z,{children:c.length>0?Object.entries(w(c)).map(([r,a],s)=>e.jsxs(A.Fragment,{children:[e.jsx(i,{children:e.jsx(n,{colSpan:"8",style:_,children:r})}),a.map((t,u)=>e.jsxs(i,{children:[e.jsx(n,{children:t.name||"N/A"}),e.jsx(n,{children:t.department||"N/A"}),e.jsx(n,{children:o(t.base_salary)}),e.jsx(n,{children:o(t.total_overtime_amount)}),e.jsx(n,{children:o(t.bonus)}),e.jsx(n,{children:o(t.benefits_total)}),e.jsx(n,{children:o(t.total_deductions||t.tax)}),e.jsx(n,{children:o(t.net_salary)})]},`${t.id}-${u}`)),e.jsxs(i,{style:k,children:[e.jsx(n,{colSpan:"6",children:e.jsx("strong",{children:"Department Total"})}),e.jsx(n,{colSpan:"2",children:e.jsx("strong",{children:o(a.reduce((t,u)=>t+parseFloat(u.net_salary||0),0))})})]}),s<Object.keys(w(c)).length-1&&e.jsx(i,{children:e.jsx(n,{colSpan:"8",style:{padding:"10px 0"},children:e.jsx("hr",{style:{borderTop:"2px solid #ddd"}})})})]},r)):e.jsx(i,{children:e.jsx(n,{colSpan:"8",className:"text-center py-4",children:m?"Error loading data":"No payroll data available for selected period"})})}),c.length>0&&e.jsx(W,{children:e.jsxs(i,{style:{backgroundColor:"#dee2e6"},children:[e.jsx(l,{colSpan:"6",children:e.jsx("strong",{children:"Grand Total"})}),e.jsx(l,{colSpan:"2",children:e.jsx("strong",{children:o(L())})})]})})]})})]})]})})};export{ee as default};
