import{r as t,a as b,j as e,C as oe}from"./index-BAyO2E5M.js";import{b as h,F as ce,p as de}from"./Compliance-CmyZk0Sd.js";import{C as ue,a as me}from"./CCardBody-DE_qiR2I.js";import{C as pe}from"./CCardHeader-DgjXZTh6.js";import{C as z}from"./CAlert-Dwouhtdc.js";import{C as xe,a as he,b as y,c as d,d as je,e as c}from"./CTable-CZKmf_kd.js";import{C as $}from"./DefaultLayout-Bxecxb4e.js";import{C as ge,a as fe}from"./CPaginationItem-DN8gZ5uQ.js";import{C as G,a as J,b as K,c as Q}from"./CModalTitle-BFzPY1rf.js";import{C as Ce}from"./CForm-CL3T_XM6.js";import{C as ve}from"./CFormSelect-B8keXU-z.js";import{C as be,a as W}from"./CRow-jB5mWDoF.js";import{C as D}from"./CFormInput-B4GftH-Q.js";import{C as ye}from"./CFormTextarea-BFPllmpz.js";import{C as X}from"./CModalFooter-_jnTenoP.js";import"./CFormControlWrapper-CVzywb50.js";const He=()=>{const[S,Y]=t.useState([]),[Z,j]=t.useState(!0),[T,L]=t.useState(null),[ee,q]=t.useState(!1),[g,F]=t.useState(""),[u,N]=t.useState(""),[m,R]=t.useState(""),[f,w]=t.useState(""),[E,I]=t.useState(null),[n,P]=t.useState({}),[r,p]=t.useState({visible:!1,type:"",message:""}),[_,se]=t.useState(1),[C,De]=t.useState(10),[i,v]=t.useState(null),[te,ae]=t.useState([]),o=sessionStorage.getItem("user_id");t.useEffect(()=>{if(r.visible){const s=setTimeout(()=>p({...r,visible:!1}),3e3);return()=>clearTimeout(s)}},[r]),t.useEffect(()=>{if(!o){L("User ID not found. Please log in again."),j(!1);return}M(),re()},[o]);const M=t.useCallback(async()=>{try{j(!0);const s=await b.get(`/api/leave/${o}`);Y(s.data.leaveRequests||[])}catch{L("Failed to load leave requests. Please try again later.")}finally{j(!1)}},[o]),re=t.useCallback(async()=>{try{const s=await b.get("/api/leave-types");ae(s.data)}catch(s){console.error("Error fetching leave types:",s)}},[]),k=s=>{switch(s){case"Pending":return"warning";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},ne=s=>{const a=s.target.files[0];a&&I(a)},le=async s=>{var O,U,V;if(s.preventDefault(),!o||isNaN(o)){p({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}const a={};if(g.trim()||(a.leaveType="Leave Type is required"),u.trim()||(a.startDate="Start Date is required"),m.trim()?new Date(u)>new Date(m)&&(a.endDate="End Date must be after Start Date"):a.endDate="End Date is required",f.trim()||(a.reason="Reason is required"),Object.keys(a).length>0){P(a);return}P({});const l=new FormData;l.append("user_id",o),l.append("name",sessionStorage.getItem("name")||""),l.append("leave_type",g),l.append("start_date",u),l.append("end_date",m),l.append("reason",f),E&&l.append("document",E);try{const x=await b.post("/api/leave-request",l,{headers:{"Content-Type":"multipart/form-data"}});p({visible:!0,type:"success",message:"Leave request submitted successfully!"}),F(""),N(""),R(""),w(""),I(null),M()}catch(x){console.error("Error Response:",(O=x.response)==null?void 0:O.data),p({visible:!0,type:"danger",message:(V=(U=x.response)==null?void 0:U.data)!=null&&V.errors?Object.values(x.response.data.errors).flat().join(" "):"Failed to submit leave request."})}},A=_*C,B=A-C,H=S.slice(B,A),ie=s=>se(s);return e.jsxs(ue,{children:[e.jsxs(pe,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"My Leave Requests"}),e.jsx(h,{className:"float-end",color:"primary",onClick:()=>q(!0),children:"Request Leave"})]}),e.jsx(me,{children:Z?e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):T?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:T})}):e.jsxs(e.Fragment,{children:[r.visible&&e.jsx(z,{color:r.type,dismissible:!0,children:r.message}),e.jsxs(xe,{hover:!0,responsive:!0,children:[e.jsx(he,{children:e.jsxs(y,{className:"text-center",children:[e.jsx(d,{children:"#"}),e.jsx(d,{children:"Leave Type"}),e.jsx(d,{children:"Date Requested"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(je,{className:"text-center",children:H.length===0?e.jsx(y,{children:e.jsx(c,{colSpan:"5",className:"text-center",children:"No leave requests available."})}):H.map((s,a)=>e.jsxs(y,{children:[e.jsx(c,{children:B+a+1}),e.jsx(c,{children:s.leave_type}),e.jsx(c,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(c,{children:e.jsx($,{color:k(s.status),children:s.status})}),e.jsx(c,{children:e.jsx(h,{color:"info",size:"sm",onClick:()=>v(s),children:e.jsx(ce,{icon:de})})})]},s.id))})]}),e.jsx(ge,{className:"mt-3",children:Array.from({length:Math.ceil(S.length/C)},(s,a)=>e.jsx(fe,{active:a+1===_,onClick:()=>ie(a+1),children:a+1},a+1))})]})}),e.jsxs(G,{visible:ee,onClose:()=>q(!1),children:[e.jsx(J,{children:e.jsx(K,{children:"Leave Request"})}),e.jsxs(Q,{children:[r.visible&&e.jsx(z,{color:r.type,dismissible:!0,children:r.message}),e.jsxs(Ce,{onSubmit:le,id:"leaveForm",children:[e.jsxs(ve,{label:"Leave Type",value:g,onChange:s=>F(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),te.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),n.leaveType&&e.jsx("span",{className:"text-danger",children:n.leaveType}),e.jsx("br",{}),e.jsxs(be,{children:[e.jsxs(W,{className:"mb-3",children:[e.jsx(D,{type:"date",label:"Start Date",value:u,onChange:s=>N(s.target.value),required:!0}),n.startDate&&e.jsx("span",{className:"text-danger",children:n.startDate})]}),e.jsxs(W,{className:"mb-3",children:[e.jsx(D,{type:"date",label:"End Date",value:m,onChange:s=>R(s.target.value),required:!0}),n.endDate&&e.jsx("span",{className:"text-danger",children:n.endDate})]})]}),e.jsx(ye,{label:"Reason",value:f,onChange:s=>w(s.target.value),required:!0}),n.reason&&e.jsx("span",{className:"text-danger",children:n.reason}),e.jsx("br",{}),e.jsx(D,{type:"file",label:"Upload Document",onChange:ne,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg"}),e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Notice:"})," Please combine multiple files or images into a single PDF before uploading."]}),e.jsx("br",{}),e.jsx("br",{})]})]}),e.jsx(X,{children:e.jsx(h,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]}),e.jsxs(G,{visible:!!i,onClose:()=>v(null),children:[e.jsx(J,{children:e.jsx(K,{children:"Leave Details"})}),e.jsx(Q,{children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Leave Type:"})," ",i.leave_type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",i.reason]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Requested:"})," ",new Date(i.created_at).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx($,{color:k(i.status),children:i.status})]})]})}),e.jsx(X,{children:e.jsx(h,{color:"secondary",onClick:()=>v(null),children:"Close"})})]})]})};export{He as default};
