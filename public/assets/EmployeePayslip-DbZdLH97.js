import{r as o,j as e,C as j,a as p}from"./index-BAyO2E5M.js";import{b as g,F,k as B,o as M}from"./Compliance-CmyZk0Sd.js";import{C as k,a as R}from"./CCardBody-DE_qiR2I.js";import{C as U}from"./CCardHeader-DgjXZTh6.js";import{C}from"./CAlert-Dwouhtdc.js";import{C as O,a as Y,b as w,c as d,d as z,e as c}from"./CTable-CZKmf_kd.js";import{C as G,a as V,b as W,c as X}from"./CModalTitle-BFzPY1rf.js";import"./DefaultLayout-Bxecxb4e.js";const ne=()=>{const[y,x]=o.useState([]),[D,P]=o.useState(!0),[f,r]=o.useState(null),[_,b]=o.useState(!1),[t,v]=o.useState(null),[q,L]=o.useState(new Date().toLocaleString("default",{month:"long"})),[S,N]=o.useState(new Date().getFullYear()),[m,h]=o.useState(!1),u=s=>{const a=new Date;return a.setMonth(s-1),a.toLocaleString("default",{month:"long"})},E=async()=>{try{const s=sessionStorage.getItem("user_id");if(!s){r("User ID not found in session. Please log in again.");return}const a=await p.get("/api/releases",{params:{user_id:s}});console.log("API Response:",a.data),Array.isArray(a.data.payslips)?x(a.data.payslips):(r("Invalid payslip data format."),x([]))}catch(s){console.error("Error fetching payslips:",s),s.response&&s.response.status===404?r("No payslips found for the specified employee."):r("Failed to fetch payslips. Please try again later."),x([])}finally{P(!1)}};o.useEffect(()=>{E()},[]);const H=s=>{v(s);const a=u(s.month),i=s.year;`${i}${String(s.month).padStart(2,"0")}`,new Date(i,s.month,0).toISOString().split("T")[0],L(a),N(i),b(!0)},I=async(s,a,i)=>{h(!0);try{const n=await p.get(`/api/releases/download/${s}`,{responseType:"blob"}),A=u(i),$=window.URL.createObjectURL(new Blob([n.data])),l=document.createElement("a");l.href=$,l.setAttribute("download",`Payslip-${A}-${a}.pdf`),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(n){console.error("Error downloading payslip:",n),r("Failed to download payslip. Please try again.")}finally{h(!1)}},T=async()=>{h(!0);try{const s=sessionStorage.getItem("user_id");if(!s){r("User ID not found in session. Please log in again.");return}const a=await p.get("/api/releases/download-all",{params:{user_id:s},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([a.data])),n=document.createElement("a");n.href=i,n.setAttribute("download","all-payslips.pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(s){console.error("Error downloading all payslips:",s),r("Failed to download all payslips. Please try again.")}finally{h(!1)}};return e.jsxs(k,{children:[e.jsxs(U,{children:[e.jsx("strong",{children:"My Payslips"}),e.jsx(g,{color:"primary",className:"float-end",onClick:T,disabled:m,children:m?e.jsx(j,{size:"sm"}):"Download All Payslips"})]}),e.jsx(R,{children:D?e.jsxs("div",{className:"text-center",children:[e.jsx(j,{color:"primary"}),e.jsx("p",{children:"Loading payslips..."})]}):f?e.jsx(C,{color:"danger",children:f}):y.length===0?e.jsx(C,{color:"info",children:"No payslips available."}):e.jsxs(O,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Month"}),e.jsx(d,{children:"Year"}),e.jsx(d,{children:"Net Salary"}),e.jsx(d,{children:"Status"}),e.jsx(d,{})]})}),e.jsx(z,{children:y.map(s=>e.jsxs(w,{children:[e.jsx(c,{children:u(s.month)}),e.jsx(c,{children:s.year}),e.jsx(c,{children:parseFloat(s.net_salary||0).toLocaleString("en-US",{style:"currency",currency:"PHP",minimumFractionDigits:2})}),e.jsx(c,{children:e.jsx("span",{style:{color:s.status==="Paid"?"green":"orange",fontWeight:"bold"},children:s.status})}),e.jsxs(c,{children:[e.jsx(g,{color:"secondary",onClick:()=>H(s),children:e.jsx(F,{icon:B})}),e.jsx(g,{color:"success",className:"ms-2",onClick:()=>I(s.employee_id,s.name,s.month),disabled:m,children:m?e.jsx(j,{size:"sm"}):e.jsx(F,{icon:M})})]})]},s.id||`${s.user_id}-${s.month}-${s.year}`))})]})}),e.jsxs(G,{visible:_,onClose:()=>b(!1),size:"lg",children:[e.jsx(V,{closeButton:!0,children:e.jsxs(W,{children:["Payslip for ",t==null?void 0:t.name]})}),e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pay Period:"})," ",`${S}-${String(t.month).padStart(2,"0")}-01`," –"," ",new Date(S,t.month,0).toISOString().split("T")[0]]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee Name:"})," ",t.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Employee ID:"})," ",t.employee_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Position:"})," ",t.job_position]})]}),e.jsx("div",{className:"table-responsive",style:{overflowX:"auto"},children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Earnings"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Deductions"}),e.jsx("th",{children:"Amount"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Base Salary"}),e.jsxs("td",{children:["₱",parseFloat(t.base_salary||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{children:"Deduction"}),e.jsxs("td",{children:["₱",parseFloat(t.deduction||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Overtime Pay"}),e.jsxs("td",{children:["₱",parseFloat(t.total_overtime_amount||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Bonus"}),e.jsxs("td",{children:["₱",parseFloat(t.bonus||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{}),e.jsx("td",{})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Gross Salary"}),e.jsxs("th",{children:["₱",(parseFloat(t.base_salary||0)+parseFloat(t.total_overtime_amount||0)+parseFloat(t.bonus||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("th",{children:"Total Deductions"}),e.jsxs("th",{children:["₱",parseFloat(t.deduction||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Net Pay"}),e.jsxs("th",{colSpan:"3",children:["₱",(parseFloat(t.base_salary||0)+parseFloat(t.total_overtime_amount||0)+parseFloat(t.bonus||0)-parseFloat(t.deduction||0)).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]})})]})})]})]})};export{ne as default};
