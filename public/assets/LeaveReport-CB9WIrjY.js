import{r as o,j as e,C as B,R as E}from"./index-DLmnIqy-.js";import{a as P,F as _,B as k}from"./index-BzeTyS9E.js";import{a as p}from"./api-DwbPoVFv.js";import{C as I,a as U}from"./CCardBody-DfS5_nuD.js";import{C as A}from"./CCardHeader-BhAXpAMg.js";import{C as y}from"./CFormSelect-CKgELBJY.js";import{C as q}from"./CAlert-BZjV-HHH.js";import{C as H,a as Y,b as h,c as n,d as $,e as r}from"./CTable-DPZp-y3R.js";import{a as j}from"./DefaultLayout-da0zcv8b.js";import"./index-xsH4HHeE.js";import"./CFormControlWrapper-BnNbabf9.js";const te=()=>{const[u,C]=o.useState([]),[M,b]=o.useState([]),[c,N]=o.useState(new Date().getFullYear()),[l,w]=o.useState(new Date().getMonth()+1),[g,x]=o.useState(!1),[f,m]=o.useState(null),D=Array.from({length:new Date().getFullYear()-2020+1},(t,a)=>2020+a),v=async()=>{try{x(!0),m(null);const t=c&&l?{year:c,month:l}:{},[a,s]=await Promise.all([p.get("/leave-requests/page",{params:t}),p.get("/leave-types")]);C(a.data.leaveRequests||a.data),b(s.data)}catch(t){m("Error fetching leave data."),console.error(t)}finally{x(!1)}};o.useEffect(()=>{v()},[c,l]);const S=t=>t.reduce((a,s)=>{const d=s.department||"Unassigned";return a[d]||(a[d]=[]),a[d].push(s),a},{}),R=async()=>{try{x(!0),m(null);const t=`${l}/${c}`,a={year:c,month:l,password:t},s=await p.get("/generate-report",{params:a,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.href=d,i.setAttribute("download",`leave-report-${c}-${l}.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d)}catch(t){m("Error generating PDF report."),console.error(t)}finally{x(!1)}},L=t=>{let a;switch(t){case"Approved":a="success";break;case"Rejected":a="danger";break;default:a="warning"}return e.jsx(j,{color:a,children:t})},F=t=>t==="Paid"?e.jsx(j,{color:"success",children:"Paid"}):e.jsx(j,{color:"secondary",children:"Unpaid"}),T={fontWeight:"bold",fontSize:"1.1em",padding:"10px",backgroundColor:"#f0f0f0"};return e.jsx("div",{children:e.jsxs(I,{className:"mb-4",children:[e.jsxs(A,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Leave Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(y,{value:l,onChange:t=>w(parseInt(t.target.value)),style:{width:"120px"},children:Array.from({length:12},(t,a)=>{const s=a+1;return e.jsx("option",{value:s,children:new Date(2e3,a).toLocaleString("default",{month:"long"})},s)})}),e.jsx(y,{value:c,onChange:t=>N(parseInt(t.target.value)),style:{width:"90px"},children:D.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs(P,{color:"danger",onClick:R,disabled:g,children:[e.jsx(_,{icon:k})," Export"]})]})]}),e.jsxs(U,{children:[f&&e.jsx(q,{color:"danger",children:f}),g?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(B,{color:"primary"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(h,{children:[e.jsx(n,{className:"text-center",children:"ID"}),e.jsx(n,{className:"text-center",children:"Employee ID"}),e.jsx(n,{children:"Name"}),e.jsx(n,{className:"text-center",children:"Department"}),e.jsx(n,{className:"text-center",children:"Job Position"}),e.jsx(n,{className:"text-center",children:"Leave Type"}),e.jsx(n,{className:"text-center",children:"Duration"}),e.jsx(n,{className:"text-center",children:"Days"}),e.jsx(n,{className:"text-center",children:"Reason"}),e.jsx(n,{className:"text-center",children:"Paid"}),e.jsx(n,{className:"text-center",children:"Status"})]})}),e.jsx($,{children:u.length>0?Object.entries(S(u)).map(([t,a])=>e.jsxs(E.Fragment,{children:[e.jsx(h,{children:e.jsx(r,{colSpan:"10",style:T,children:e.jsxs("strong",{children:[t," Department"]})})}),a.map(s=>e.jsxs(h,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:s.employeeId}),e.jsx(r,{children:s.name}),e.jsx(r,{className:"text-center",children:s.department||"Unassigned"}),e.jsx(r,{className:"text-center",children:s.job_position}),e.jsx(r,{className:"text-center",children:s.leave_type}),e.jsxs(r,{className:"text-center",children:[new Date(s.start_date).toLocaleDateString()," -"," ",new Date(s.end_date).toLocaleDateString()]}),e.jsx(r,{className:"text-center",children:s.total_days}),e.jsx(r,{className:"text-center",children:s.reason}),e.jsx(r,{className:"text-center",children:F(s.is_paid)}),e.jsx(r,{className:"text-center",children:L(s.status)})]},s.id))]},t)):e.jsx(h,{children:e.jsx(r,{colSpan:"10",className:"text-center",children:"No leave data available for the selected period"})})})]})})})]})]})})};export{te as default};
