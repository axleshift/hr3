import{k as R,r,l as g,i as w,j as e}from"./index-BE17hZRv.js";import{a as q}from"./api-b5EB9aEo.js";import{C as T,a as f}from"./CRow-CrtATQ_P.js";import{C as I,a as k}from"./CCardBody-D77FAhOK.js";import{C as B}from"./CCardHeader-CWsWfkQB.js";import{C as A}from"./CAlert-CHmOWjoR.js";import{C as O}from"./CForm-DnTuMTJV.js";import{C as P}from"./CFormSelect-CxYPkiR7.js";import{C as j}from"./CFormInput-P61gnO9f.js";import{C as U}from"./CFormTextarea-BNjB4Zzh.js";import{a as V}from"./index-DZu0FN0C.js";import"./index-xsH4HHeE.js";import"./CFormControlWrapper-BidSriqe.js";const M=()=>{const l=R(),[u,n]=r.useState("loading"),p=async a=>{try{const c=await q.post("/auth/verify-session",{session_id:a});l({type:"SET_USER",payload:c.data.user}),l({type:"SET_SESSION_ID",payload:a}),n("authenticated")}catch{g.get("dcims")&&g.remove("dcims",{path:"/",secure:window.location.protocol==="https:",sameSite:"strict"}),n("unauthenticated")}};return r.useEffect(()=>{const a=g.get("dcims");return a?p(a):n("unauthenticated"),()=>{}},[l]),u},ae=()=>{const[l,u]=r.useState(""),[n,p]=r.useState(""),[a,c]=r.useState(""),[x,y]=r.useState(""),[C,S]=r.useState(null),[i,b]=r.useState({}),[d,m]=r.useState({visible:!1,type:"",message:""});w();const N=M(),v={user_id:sessionStorage.getItem("user_id")||"",name:sessionStorage.getItem("name")||""},_=t=>{const s=t.target.files[0];s&&S(s)},F=async t=>{var D,L,E;if(t.preventDefault(),!v.user_id||isNaN(v.user_id)){m({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}const s={};if(l.trim()||(s.leaveType="Leave Type is required"),n.trim()||(s.startDate="Start Date is required"),a.trim()?new Date(n)>new Date(a)&&(s.endDate="End Date must be after Start Date"):s.endDate="End Date is required",x.trim()||(s.reason="Reason is required"),Object.keys(s).length>0){b(s);return}b({});const o=new FormData;o.append("user_id",v.user_id),o.append("name",v.name),o.append("leave_type",l),o.append("start_date",n),o.append("end_date",a),o.append("reason",x),C&&o.append("document",C);try{const h=await q.post("/api/leave-requests",o,{headers:{"Content-Type":"multipart/form-data"}});m({visible:!0,type:"success",message:"Leave request submitted successfully!"}),u(""),p(""),c(""),y(""),S(null)}catch(h){console.error("Error Response:",(D=h.response)==null?void 0:D.data),m({visible:!0,type:"danger",message:(E=(L=h.response)==null?void 0:L.data)!=null&&E.errors?Object.values(h.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return r.useEffect(()=>{if(d.visible){const t=setTimeout(()=>m({...d,visible:!1}),3e3);return()=>clearTimeout(t)}},[d]),N==="loading"?e.jsx("div",{children:"Loading..."}):e.jsx(T,{children:e.jsx(f,{xs:12,children:e.jsxs(I,{children:[e.jsx(B,{children:e.jsx("strong",{children:"Leave Request"})}),e.jsxs(k,{children:[d.visible&&e.jsx(A,{color:d.type,dismissible:!0,children:d.message}),e.jsxs(O,{onSubmit:F,children:[e.jsxs(P,{label:"Leave Type",value:l,onChange:t=>u(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation Leave",children:"Vacation Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"}),e.jsx("option",{value:"Maternity Leave",children:"Maternity Leave"}),e.jsx("option",{value:"Calamity Leave",children:"Calamity Leave"}),e.jsx("option",{value:"Bereavement Leave",children:"Bereavement Leave"})]}),i.leaveType&&e.jsx("span",{className:"text-danger",children:i.leaveType}),e.jsx("br",{}),e.jsxs(T,{children:[e.jsxs(f,{className:"mb-3",children:[e.jsx(j,{type:"date",label:"Start Date",value:n,onChange:t=>p(t.target.value),required:!0}),i.startDate&&e.jsx("span",{className:"text-danger",children:i.startDate})]}),e.jsxs(f,{className:"mb-3",children:[e.jsx(j,{type:"date",label:"End Date",value:a,onChange:t=>c(t.target.value),required:!0}),i.endDate&&e.jsx("span",{className:"text-danger",children:i.endDate})]})]}),e.jsx(U,{label:"Reason",value:x,onChange:t=>y(t.target.value),required:!0}),i.reason&&e.jsx("span",{className:"text-danger",children:i.reason}),e.jsx("br",{}),e.jsx(j,{type:"file",label:"Upload Document",onChange:_,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg"}),e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Notice:"})," Please combine multiple files or images into a single PDF before uploading."]}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(V,{type:"submit",color:"primary",children:"Submit Request"})]})]})]})})})};export{ae as default};
