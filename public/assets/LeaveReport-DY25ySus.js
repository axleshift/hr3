import{r as d,j as e,C as N,R as k,m as u}from"./index-B-AsXKre.js";import{a as A,F as _,D as B}from"./index-v7cK04wO.js";import{C as O,a as y}from"./CCardBody-DKKJMoCm.js";import{C as P}from"./CCardHeader-DmbvFpT-.js";import{C as g}from"./CFormSelect-C603MhRX.js";import{C as f,a as v,b as o,c as l,d as b,e as n}from"./CTable-BTE33GOm.js";import"./CFormControlWrapper-RXHt9VgW.js";const z=()=>{const[h,C]=d.useState([]),[c,w]=d.useState(new Date().getFullYear()),[i,D]=d.useState(new Date().getMonth()+1),[S,m]=d.useState(!1),[x,p]=d.useState(null),L=Array.from({length:new Date().getFullYear()-2020+1},(t,r)=>2020+r),R=async()=>{try{m(!0);const t=await u.get("/api/leave-requests",{params:{year:c,month:i}}),r=t.data.leaveRequests||t.data;Array.isArray(r)?C(r):p("Invalid leave data format.")}catch{p("Error fetching leave data.")}finally{m(!1)}};d.useEffect(()=>{R()},[c,i]);const j=t=>t.reduce((r,a)=>{const s=a.department||"Unassigned";return r[s]||(r[s]=[]),r[s].push(a),r},{}),T=async()=>{try{const t=await u.get("/api/generate-leave",{params:{year:c,month:i},responseType:"blob"}),r=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=r,a.setAttribute("download",`leave-report-${c}-${i}.pdf`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}catch(t){console.error("Error downloading PDF:",t),alert("Failed to download the PDF. Please try again.")}},F=()=>{const t=h.reduce((r,a)=>{const s=a.name;return r[s]||(r[s]=0),r[s]+=1,r},{});return Object.entries(t).map(([r,a])=>({name:r,totalLeaves:a}))},E={fontWeight:"bold",fontSize:"1.1em",padding:"10px"};return e.jsx("div",{children:e.jsxs(O,{className:"mb-4",children:[e.jsxs(P,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Leave Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(g,{value:i,onChange:t=>D(parseInt(t.target.value)),style:{width:"120px"},children:Array.from({length:12},(t,r)=>e.jsx("option",{value:r+1,children:new Date(2023,r).toLocaleString("default",{month:"long"})},r+1))}),e.jsx(g,{value:c,onChange:t=>w(parseInt(t.target.value)),style:{width:"90px"},children:L.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(A,{color:"primary",onClick:T,children:e.jsx(_,{icon:B})})]})]}),e.jsxs(y,{children:[x&&e.jsx("div",{style:{color:"red"},children:x}),S?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(N,{color:"primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Summary of Leaves Taken by Employees"}),e.jsx(y,{children:e.jsxs(f,{hover:!0,bordered:!0,responsive:!0,children:[e.jsx(v,{children:e.jsxs(o,{children:[e.jsx(l,{children:"Employee Name"}),e.jsx(l,{children:"Total Leaves Taken"})]})}),e.jsx(b,{children:F().map(t=>e.jsxs(o,{children:[e.jsx(n,{children:t.name}),e.jsx(n,{className:"text-center",children:t.totalLeaves})]},t.name))})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(f,{hover:!0,bordered:!0,responsive:!0,children:[e.jsx(v,{children:e.jsxs(o,{children:[e.jsx(l,{children:"Employee Name"}),e.jsx(l,{children:"Department"}),e.jsx(l,{children:"Leave Type"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Total Days"})]})}),e.jsx(b,{children:h.length>0?Object.entries(j(h)).map(([t,r],a)=>e.jsxs(k.Fragment,{children:[e.jsx(o,{children:e.jsx(n,{colSpan:"7",style:E,children:e.jsxs("strong",{children:["Department: ",t]})})}),r.map(s=>e.jsxs(o,{children:[e.jsx(n,{children:s.name}),e.jsx(n,{children:s.department}),e.jsx(n,{children:s.leave_type}),e.jsxs(n,{children:[new Date(s.start_date).toLocaleDateString()," -"," ",new Date(s.end_date).toLocaleDateString()]}),e.jsx(n,{children:e.jsx("span",{style:{color:s.status==="Approved"?"green":s.status==="Rejected"?"red":"orange"},children:s.status})}),e.jsx(n,{children:s.total_days})]},s.id)),a<Object.keys(j(h)).length-1&&e.jsx(o,{children:e.jsx(n,{colSpan:"7",style:{padding:"10px 0"},children:e.jsx("hr",{style:{borderTop:"2px solid #ddd"}})})})]},t)):e.jsx(o,{children:e.jsx(n,{colSpan:"7",className:"text-center",children:"No leave data available"})})})]})})]})]})]})})};export{z as default};
