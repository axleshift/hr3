import{r as o,j as e,C as k,R as E,m as d}from"./index-Bi-v-Kal.js";import{a as g,F as U,E as _}from"./index-D_Bixaei.js";import{C as B,a as A}from"./CCardBody-CXRMg5zC.js";import{C as I}from"./CCardHeader-DbgGSS-j.js";import{C as f}from"./CFormSelect-D8WnZ7AH.js";import{C as q}from"./CAlert-B2LPwVDN.js";import{C as H,a as Y,b as i,c as n,d as $,e as r}from"./CTable-_A7mZ4wq.js";import{C as m}from"./DefaultLayout-DY2AG2Rb.js";import"./CFormControlWrapper-C4S1W_Ya.js";const Z=()=>{const[h,C]=o.useState([]),[M,w]=o.useState([]),[c,y]=o.useState(new Date().getFullYear()),[l,b]=o.useState(new Date().getMonth()+1),[N,p]=o.useState(!1),[j,u]=o.useState(null),D=Array.from({length:new Date().getFullYear()-2020+1},(t,a)=>2020+a),v=async()=>{try{p(!0),u(null);const t=c&&l?{year:c,month:l}:{},[a,s]=await Promise.all([d.get("/leave-requests/page",{params:t}),d.get("/leave-types")]);C(a.data.leaveRequests||a.data),w(s.data)}catch(t){u("Error fetching leave data."),console.error(t)}finally{p(!1)}};o.useEffect(()=>{v()},[c,l]);const S=t=>t.reduce((a,s)=>{const x=s.department||"Unassigned";return a[x]||(a[x]=[]),a[x].push(s),a},{}),R=async()=>{try{const t=await d.get("/generate-report",{params:{year:c,month:l},responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",`leave-report-${c}-${l}.pdf`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(t){console.error("Error downloading PDF:",t),alert("Failed to download the PDF. Please try again.")}},L=()=>{const t=new URLSearchParams({year:c,month:l}).toString();window.open(`${d.defaults.baseURL}/view-report?${t}`,"_blank")},F=t=>{let a;switch(t){case"Approved":a="success";break;case"Rejected":a="danger";break;default:a="warning"}return e.jsx(m,{color:a,children:t})},P=t=>t==="Paid"?e.jsx(m,{color:"success",children:"Paid"}):e.jsx(m,{color:"secondary",children:"Unpaid"}),T={fontWeight:"bold",fontSize:"1.1em",padding:"10px",backgroundColor:"#f0f0f0"};return e.jsx("div",{children:e.jsxs(B,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Leave Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(f,{value:l,onChange:t=>b(parseInt(t.target.value)),style:{width:"120px"},children:Array.from({length:12},(t,a)=>{const s=a+1;return e.jsx("option",{value:s,children:new Date(2e3,a).toLocaleString("default",{month:"long"})},s)})}),e.jsx(f,{value:c,onChange:t=>y(parseInt(t.target.value)),style:{width:"90px"},children:D.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs(g,{color:"danger",onClick:R,children:[e.jsx(U,{icon:_})," Export PDF"]}),e.jsxs(g,{color:"info",onClick:L,className:"ms-2",children:[" ","View PDF"]})]})]}),e.jsxs(A,{children:[j&&e.jsx(q,{color:"danger",children:j}),N?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(k,{color:"primary"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx(Y,{children:e.jsxs(i,{children:[e.jsx(n,{className:"text-center",children:"ID"}),e.jsx(n,{children:"Name"}),e.jsx(n,{className:"text-center",children:"Department"}),e.jsx(n,{className:"text-center",children:"Job Position"}),e.jsx(n,{className:"text-center",children:"Leave Type"}),e.jsx(n,{className:"text-center",children:"Duration"}),e.jsx(n,{className:"text-center",children:"Days"}),e.jsx(n,{className:"text-center",children:"Reason"}),e.jsx(n,{className:"text-center",children:"Paid"}),e.jsx(n,{className:"text-center",children:"Status"})]})}),e.jsx($,{children:h.length>0?Object.entries(S(h)).map(([t,a])=>e.jsxs(E.Fragment,{children:[e.jsx(i,{children:e.jsx(r,{colSpan:"10",style:T,children:e.jsxs("strong",{children:[t," Department"]})})}),a.map(s=>e.jsxs(i,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:s.name}),e.jsx(r,{className:"text-center",children:s.department||"Unassigned"}),e.jsx(r,{className:"text-center",children:s.job_position}),e.jsx(r,{className:"text-center",children:s.leave_type}),e.jsxs(r,{className:"text-center",children:[new Date(s.start_date).toLocaleDateString()," -"," ",new Date(s.end_date).toLocaleDateString()]}),e.jsx(r,{className:"text-center",children:s.total_days}),e.jsx(r,{className:"text-center",children:s.reason}),e.jsx(r,{className:"text-center",children:P(s.is_paid)}),e.jsx(r,{className:"text-center",children:F(s.status)})]},s.id))]},t)):e.jsx(i,{children:e.jsx(r,{colSpan:"8",className:"text-center",children:"No leave data available for the selected period"})})})]})})})]})]})})};export{Z as default};
