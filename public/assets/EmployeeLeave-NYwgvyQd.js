import{r as a,m as T,j as e,C as te}from"./index-DDbZvJeW.js";import{a as y,F as re,H as ne}from"./index-L_MtF71K.js";import{C as le,a as oe}from"./CCardBody-Co8lq37Q.js";import{C as ie}from"./CCardHeader-B_dnQ4Fk.js";import{C as O}from"./CAlert-DdC9cvg9.js";import{C as de,a as ce,b as w,c as m,d as pe,e as d}from"./CTable-D4MvuC7h.js";import{C as V}from"./DefaultLayout-BE_0No5-.js";import{C as $,a as J,b as z,c as W}from"./CModalTitle-BAifmKMR.js";import{C as me}from"./CForm-C9N1jgnm.js";import{C as ue}from"./CFormSelect-B1-ZEqTM.js";import{C as xe,a as G}from"./CRow-nFsBRVCw.js";import{C as q}from"./CFormInput-vQiARV7V.js";import{C as he}from"./CFormTextarea-JG5yqnSs.js";import{C as K}from"./CModalFooter-B-ZYX2eN.js";import"./CFormControlWrapper-Dd6j17pB.js";const Fe=()=>{const[R,Q]=a.useState([]),[X,u]=a.useState(!0),[_,F]=a.useState(null),[Y,v]=a.useState(!1),[b,E]=a.useState(""),[j,k]=a.useState(""),[g,A]=a.useState(""),[C,B]=a.useState(""),[D,M]=a.useState([]),[o,U]=a.useState({}),[l,x]=a.useState({visible:!1,type:"",message:""}),[t,S]=a.useState(null),[N,L]=a.useState([]),i=sessionStorage.getItem("user_id");a.useEffect(()=>{if(l.visible){const s=setTimeout(()=>x({...l,visible:!1}),3e3);return()=>clearTimeout(s)}},[l]),a.useEffect(()=>{if(!i){F("User ID not found. Please log in again."),u(!1);return}H(),Z()},[i]);const H=a.useCallback(async()=>{try{u(!0);const s=await T.get(`/leave/${i}`);Q(s.data.leaveRequests||[])}catch{F("Failed to load leave requests. Please try again later.")}finally{u(!1)}},[i]),Z=a.useCallback(async()=>{try{const s=await T.get("/leave-types");console.log("Leave types response:",s.data),s.data&&Array.isArray(s.data)?L(s.data):(console.error("Leave types data is not an array:",s.data),L([]))}catch(s){console.error("Error fetching leave types:",s),x({visible:!0,type:"danger",message:"Failed to load leave types. Please try again later."}),L([])}},[]),P=s=>{switch(s){case"Pending":return"warning";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},ee=s=>{M(s.target.files)},se=async s=>{var c,p,h,f,I;if(s.preventDefault(),!i||isNaN(i)){x({visible:!0,type:"danger",message:"Invalid User ID. Please log in again."});return}const n={};if(b.trim()||(n.leaveType="Leave Type is required"),j.trim()||(n.startDate="Start Date is required"),g.trim()?new Date(j)>new Date(g)&&(n.endDate="End Date must be after Start Date"):n.endDate="End Date is required",C.trim()||(n.reason="Reason is required"),Object.keys(n).length>0){U(n);return}U({});try{u(!0);const r=new FormData;r.append("user_id",i),r.append("name",sessionStorage.getItem("name")||""),r.append("leave_type",b),r.append("start_date",j),r.append("end_date",g),r.append("reason",C),D&&D.length>0&&Array.from(D).forEach(ae=>{r.append("documents[]",ae)});const je=await T.post("/leave-requests",r,{headers:{"Content-Type":"multipart/form-data"}});x({visible:!0,type:"success",message:"Leave request submitted successfully!"}),E(""),k(""),A(""),B(""),M(null),v(!1),await H()}catch(r){console.error("Error Response:",(c=r.response)==null?void 0:c.data),x({visible:!0,type:"danger",message:((h=(p=r.response)==null?void 0:p.data)==null?void 0:h.message)||((I=(f=r.response)==null?void 0:f.data)!=null&&I.errors?Object.values(r.response.data.errors).flat().join(" "):"Failed to submit leave request.")})}finally{u(!1)}};return e.jsxs(le,{children:[e.jsxs(ie,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"My Leave Requests"}),e.jsx(y,{className:"float-end",color:"primary",onClick:()=>v(!0),children:"Request Leave"})]}),e.jsx(oe,{children:X?e.jsxs("div",{className:"text-center",children:[e.jsx(te,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):_?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:_})}):e.jsxs(e.Fragment,{children:[l.visible&&e.jsx(O,{color:l.type,dismissible:!0,children:l.message}),e.jsxs(de,{hover:!0,responsive:!0,children:[e.jsx(ce,{children:e.jsxs(w,{className:"text-center",children:[e.jsx(m,{children:"#"}),e.jsx(m,{children:"Leave Type"}),e.jsx(m,{children:"Date Requested"}),e.jsx(m,{children:"Duration"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(pe,{className:"text-center",children:R.length===0?e.jsx(w,{children:e.jsx(d,{colSpan:"5",className:"text-center",children:"No leave requests available."})}):R.map((s,n)=>e.jsxs(w,{children:[e.jsx(d,{children:n+1}),e.jsx(d,{children:s.leave_type}),e.jsx(d,{children:new Date(s.created_at).toLocaleDateString()}),e.jsxs(d,{children:[new Date(s.start_date).toLocaleDateString()," -"," ",new Date(s.end_date).toLocaleDateString()]}),e.jsx(d,{children:e.jsx(V,{color:P(s.status),children:s.status})}),e.jsx(d,{children:e.jsx(y,{color:"info",onClick:()=>S(s),style:{cursor:"pointer"},children:e.jsx(re,{icon:ne})})})]},s.id))})]})]})}),e.jsxs($,{visible:Y,onClose:()=>v(!1),children:[e.jsx(J,{children:e.jsx(z,{children:"Leave Request"})}),e.jsxs(W,{children:[l.visible&&e.jsx(O,{color:l.type,dismissible:!0,children:l.message}),e.jsxs(me,{onSubmit:se,id:"leaveForm",children:[e.jsxs(ue,{label:"Leave Type",value:b,onChange:s=>E(s.target.value),required:!0,disabled:N.length===0,children:[e.jsx("option",{value:"",children:N.length===0?"Loading leave types...":"Select Leave Type"}),N.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]}),o.leaveType&&e.jsx("span",{className:"text-danger",children:o.leaveType}),e.jsx("br",{}),e.jsxs(xe,{children:[e.jsxs(G,{className:"mb-3",children:[e.jsx(q,{type:"date",label:"Start Date",value:j,onChange:s=>k(s.target.value),required:!0}),o.startDate&&e.jsx("span",{className:"text-danger",children:o.startDate})]}),e.jsxs(G,{className:"mb-3",children:[e.jsx(q,{type:"date",label:"End Date",value:g,onChange:s=>A(s.target.value),required:!0}),o.endDate&&e.jsx("span",{className:"text-danger",children:o.endDate})]})]}),e.jsx(he,{label:"Reason",value:C,onChange:s=>B(s.target.value),required:!0}),o.reason&&e.jsx("span",{className:"text-danger",children:o.reason}),e.jsx("br",{}),e.jsx(q,{type:"file",label:"Upload Document",onChange:ee,accept:"image/*,.pdf,.doc,.docx,.txt,.jpg,.png,.jpeg",multiple:!0}),e.jsx("br",{}),e.jsx("br",{})]})]}),e.jsx(K,{children:e.jsx(y,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]}),e.jsxs($,{visible:!!t,onClose:()=>S(null),size:"lg",children:[e.jsx(J,{children:e.jsx(z,{children:"Leave Details"})}),e.jsx(W,{children:t?e.jsxs("div",{className:"leave-details-container",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Department:"})," ",t.department]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Job Position:"})," ",t.job_position]})]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Date Requested:"})," ",new Date(t.created_at).toLocaleDateString()]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Duration:"})," ",new Date(t.start_date).toLocaleDateString()," ","- ",new Date(t.end_date).toLocaleDateString()]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Leave Type:"})," ",t.leave_type]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Reason:"})," ",t.reason]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(V,{color:P(t.status),children:t.status})]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Remarks:"})," ",t.remarks||"N/A"]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{children:e.jsx("strong",{children:"Documents:"})}),(()=>{try{const s=typeof t.document_path=="string"?JSON.parse(t.document_path):t.document_path;return Array.isArray(s)&&s.length>0?e.jsx("ul",{style:{listStyleType:"none",paddingLeft:0},children:s.map((n,c)=>{const p=`http://localhost:8000/storage/${n}`,h=n.split(".").pop().toLowerCase(),f=["jpg","jpeg","png"].includes(h);return e.jsx("li",{style:{marginBottom:"10px"},children:f?e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("img",{src:p,alt:`Uploaded file ${c+1}`,style:{maxWidth:"100px",maxHeight:"100px",marginRight:"10px",border:"1px solid #ddd",borderRadius:"4px"}}),e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none"},children:"Open Full Image"})]}):e.jsxs("a",{href:p,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"5px 10px",backgroundColor:"#f8f9fa",border:"1px solid #ddd",borderRadius:"4px",textDecoration:"none",color:"#0d6efd"},children:["Download ",h.toUpperCase()," File (",c+1,")"]})},c)})}):e.jsx("p",{className:"text-muted",children:"No documents uploaded"})}catch(s){return console.error("Error displaying documents:",s),e.jsx("p",{className:"text-muted",children:"Unable to display documents"})}})()]})]}):e.jsx("p",{children:"No leave details found."})}),e.jsx(K,{children:e.jsx(y,{color:"secondary",onClick:()=>S(null),children:"Close"})})]})]})};export{Fe as default};
