import{r as a,j as e,C as E}from"./index-CCQjMedi.js";import{e as f,a as F}from"./api-DtbWpsV7.js";import{C as M,a as B}from"./CCardBody-CfIUcbl0.js";import{C as A}from"./CCardHeader-DSNy9un6.js";import{C as N,a as _,b as m,c as o,d as w,e as t}from"./CTable-DCrsHpmt.js";import{C as D}from"./DefaultLayout-C2FYHQkI.js";import{C as H,a as P,b as V,c as k,d as I}from"./CModalTitle-D0bAbHAp.js";import{a as O,C as $}from"./CForm-KFIMHm5K.js";import{C as z}from"./CFormSelect-Ba8ZMqlB.js";import{C as G}from"./CFormTextarea-DeHnIjIH.js";import"./CFormControlWrapper-WmVgiADm.js";const re=()=>{const[x,L]=a.useState([]),[S,i]=a.useState(!0),[v,h]=a.useState(null),[T,j]=a.useState(!1),[n,C]=a.useState(""),[d,y]=a.useState(""),[c,u]=a.useState({visible:!1,type:"",message:""}),r=sessionStorage.getItem("employee_id");a.useEffect(()=>{if(!r){h("Employee ID not found. Please log in again."),i(!1);return}g()},[r]);const g=a.useCallback(async()=>{try{i(!0);const s=await f.get(`/leave-requests/${r}`);L(s.data.leaveRequests)}catch{h("Failed to load leave requests. Please try again later.")}finally{i(!1)}},[r]),q=s=>{switch(s){case"Pending":return"primary";case"Approved":return"success";case"Rejected":return"danger";default:return"secondary"}},R=async s=>{var l,b;if(s.preventDefault(),!n||!d){u({visible:!0,type:"danger",message:"Leave Type and Reason are required."});return}try{const p=await f.post("/leave-request",{employee_id:r,leave_type:n,reason:d,status:"Pending"});u({visible:!0,type:"success",message:"Leave request submitted successfully!"}),C(""),y(""),g(),setTimeout(()=>{j(!1)},2e3)}catch(p){u({visible:!0,type:"danger",message:(b=(l=p.response)==null?void 0:l.data)!=null&&b.errors?Object.values(p.response.data.errors).flat().join(" "):"Failed to submit leave request."})}};return e.jsxs(M,{children:[e.jsx(A,{children:e.jsx("strong",{children:"My Leave Requests"})}),e.jsx(B,{children:S?e.jsxs("div",{className:"text-center",children:[e.jsx(E,{color:"primary"}),e.jsx("p",{children:"Loading..."})]}):v?e.jsx("div",{className:"text-center text-danger",children:e.jsx("p",{children:v})}):e.jsxs(N,{hover:!0,responsive:!0,children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(o,{children:"#"}),e.jsx(o,{children:"Leave Type"}),e.jsx(o,{children:"Approved Date"}),e.jsx(o,{children:"Status"})]})}),e.jsx(w,{children:x.length===0?e.jsx(m,{children:e.jsx(t,{colSpan:"4",className:"text-center",children:"No leave requests available."})}):x.map((s,l)=>e.jsxs(m,{children:[e.jsx(t,{children:l+1}),e.jsx(t,{children:s.leave_type}),e.jsx(t,{children:s.approved_date||"N/A"}),e.jsx(t,{children:e.jsx(D,{color:q(s.status),children:s.status})})]},s.id))})]})}),e.jsxs(H,{visible:T,onClose:()=>j(!1),children:[e.jsx(P,{children:e.jsx(V,{children:"Leave Request"})}),e.jsxs(k,{children:[c.visible&&e.jsx(O,{color:c.type,dismissible:!0,children:c.message}),e.jsxs($,{onSubmit:R,id:"leaveForm",children:[e.jsxs(z,{label:"Leave Type",value:n,onChange:s=>C(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Leave Type"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation Leave",children:"Vacation Leave"}),e.jsx("option",{value:"Emergency Leave",children:"Emergency Leave"})]}),e.jsx("br",{}),e.jsx(G,{label:"Reason",value:d,onChange:s=>y(s.target.value),required:!0}),e.jsx("br",{})]})]}),e.jsx(I,{children:e.jsx(F,{type:"submit",color:"primary",form:"leaveForm",children:"Submit Request"})})]})]})};export{re as default};
