import{r,i as oe,j as e,C as $}from"./index-BE17hZRv.js";import{C as p,a as ne,b as ie,c as le,d as de,e as y}from"./DefaultLayout-CWbSx2tv.js";import{a as g}from"./index-xsH4HHeE.js";import{C as h,a as n}from"./CRow-CrtATQ_P.js";import{C as me,a as ue}from"./CCardBody-D77FAhOK.js";import{C as pe}from"./CCardHeader-CWsWfkQB.js";import{a as w}from"./index-DZu0FN0C.js";import{c as he}from"./cil-plus-D8mtC-W5.js";import{C as L}from"./CAlert-CHmOWjoR.js";import{C as xe,a as Ce,b as q,c as i,d as je,e as o}from"./CTable-D32VYvW9.js";import{C as fe,a as ye,b as ge,c as ve}from"./CModalTitle-QwMdlv-s.js";import{C as Re}from"./CForm-DnTuMTJV.js";import{C as m}from"./CFormControlWrapper-BidSriqe.js";import{C as D}from"./CFormSelect-CxYPkiR7.js";import{C as Se}from"./CInputGroup-C1Zogh7F.js";import{C as be}from"./CInputGroupText-CyVIReVz.js";import{C as _}from"./CFormInput-P61gnO9f.js";import{C as z}from"./CFormTextarea-BNjB4Zzh.js";import{C as we}from"./CModalFooter-BybXRAQu.js";var qe=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M426.072,86.928A238.75,238.75,0,0,0,88.428,424.572,238.75,238.75,0,0,0,426.072,86.928ZM257.25,462.5c-114,0-206.75-92.748-206.75-206.75S143.248,49,257.25,49,464,141.748,464,255.75,371.252,462.5,257.25,462.5Z' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='221.27 305.808 147.857 232.396 125.23 255.023 221.27 351.063 388.77 183.564 366.142 160.937 221.27 305.808' class='ci-primary'/>"],De=["512 512","<rect width='34.924' height='34.924' x='256' y='95.998' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M16,496H496V16H16ZM48,48H464V464H48Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M285.313,359.032a18.123,18.123,0,0,1-15.6,8.966,18.061,18.061,0,0,1-17.327-23.157l35.67-121.277A49.577,49.577,0,0,0,194.7,190.572l-11.718,28.234,29.557,12.266,11.718-28.235a17.577,17.577,0,0,1,33.1,11.7l-35.67,121.277A50.061,50.061,0,0,0,269.709,400a50.227,50.227,0,0,0,43.25-24.853l15.1-25.913-27.646-16.115Z' class='ci-primary'/>"],Te=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M29.663,482.25l.087.087a24.847,24.847,0,0,0,17.612,7.342,25.178,25.178,0,0,0,8.1-1.345l142.006-48.172,272.5-272.5A88.832,88.832,0,0,0,344.334,42.039l-272.5,272.5L23.666,456.541A24.844,24.844,0,0,0,29.663,482.25Zm337.3-417.584a56.832,56.832,0,0,1,80.371,80.373L411.5,180.873,331.127,100.5ZM99.744,331.884,308.5,123.127,388.873,203.5,180.116,412.256,58.482,453.518Z' class='ci-primary'/>"],Ae=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M96,472a23.82,23.82,0,0,0,23.579,24H392.421A23.82,23.82,0,0,0,416,472V152H96Zm32-288H384V464H128Z' class='ci-primary'/><rect width='32' height='200' x='168' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='240' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='312' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M328,88V40c0-13.458-9.488-24-21.6-24H205.6C193.488,16,184,26.542,184,40V88H64v32H448V88ZM216,48h80V88H216Z' class='ci-primary'/>"],Me=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='348.071 141.302 260.308 229.065 172.545 141.302 149.917 163.929 237.681 251.692 149.917 339.456 172.545 362.083 260.308 274.32 348.071 362.083 370.699 339.456 282.935 251.692 370.699 163.929 348.071 141.302' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M425.706,86.294A240,240,0,0,0,86.294,425.706,240,240,0,0,0,425.706,86.294ZM256,464C141.309,464,48,370.691,48,256S141.309,48,256,48s208,93.309,208,208S370.691,464,256,464Z' class='ci-primary'/>"];const Ke=()=>{var V;const[S,T]=r.useState([]),[G,A]=r.useState(!1),[M,l]=r.useState(""),[F,x]=r.useState(""),[U,C]=r.useState(!1),[j,N]=r.useState(null),[v,H]=r.useState("create"),[X,J]=r.useState([]),[K,Q]=r.useState([]),[W,Y]=r.useState([]),[B,Z]=r.useState(null),[P,I]=r.useState(!1),ee=oe(),[a,b]=r.useState({department:"",typeOfRequest:"",category:"",reason:"",totalRequest:"",documents:[],comment:"",status:"Pending"});r.useEffect(()=>{(async()=>{try{J(["Finance","HR","IT","Operations","Marketing"]),Q(["Equipment","Travel","Payroll","Office Supplies","Software"]),Y(["Freight Cost","Regular","Special Project"])}catch{l("Failed to load dropdown data")}})(),R()},[]);const R=async()=>{A(!0);try{const s=await g.get("/api/budget-requests");T(Array.isArray(s.data)?s.data:[]),l("")}catch{l("Failed to fetch budget requests"),T([])}finally{A(!1)}},u=s=>{const{name:t,value:d}=s.target;b({...a,[t]:d})},se=s=>{Z(s.target.files[0])},k=async s=>{var t,d;s.preventDefault(),I(!0);try{const c=new FormData;Object.keys(a).forEach(f=>{f!=="documents"&&c.append(f,a[f])}),B&&c.append("documents",B),v==="create"?(await g.post("https://backend-finance.axleshift.com/api/budgetRequest",c,{headers:{"Content-Type":"multipart/form-data"}}),x("Budget request created successfully!")):(await g.put(`/api/budget-requests/${j._id}`,c,{headers:{"Content-Type":"multipart/form-data"}}),x("Budget request updated successfully!")),C(!1),R(),E()}catch(c){l(((d=(t=c.response)==null?void 0:t.data)==null?void 0:d.message)||"An error occurred")}finally{I(!1)}},re=s=>{N(s),b({department:s.department,typeOfRequest:s.typeOfRequest,category:s.category,reason:s.reason,totalRequest:s.totalRequest,documents:s.documents,comment:s.comment,status:s.status}),H("edit"),C(!0)},te=async s=>{if(window.confirm("Are you sure you want to archive this request?"))try{await g.delete(`/api/budget-requests/${s}`),x("Request archived successfully!"),R()}catch{l("Failed to archive request")}},O=async(s,t)=>{var d,c;try{await g.put(`/api/budget-requests/status/${s}`,{status:t}),x(`Request ${t.toLowerCase()} successfully!`),R()}catch(f){l(((c=(d=f.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to update status")}},E=()=>{b({department:"",typeOfRequest:"",category:"",reason:"",totalRequest:"",documents:[],comment:"",status:"Pending"}),Z(null),N(null)},ae=s=>{switch(s){case"Approved":return"success";case"Declined":return"danger";case"Pending":return"warning";case"Processing":return"info";default:return"secondary"}},ce=s=>{const t={year:"numeric",month:"long",day:"numeric"};return new Date(s).toLocaleDateString(void 0,t)};return e.jsxs(h,{children:[e.jsx(n,{xs:12,children:e.jsxs(me,{className:"mb-4",children:[e.jsxs(pe,{children:[e.jsx("strong",{children:"Budget Requests"}),e.jsx("div",{className:"float-end",children:e.jsxs(w,{color:"primary",onClick:()=>{H("create"),C(!0),E()},children:[e.jsx(p,{icon:he,className:"me-2"}),"New Request"]})})]}),e.jsxs(ue,{children:[M&&e.jsx(L,{color:"danger",dismissible:!0,onClose:()=>l(""),children:M}),F&&e.jsx(L,{color:"success",dismissible:!0,onClose:()=>x(""),children:F}),G?e.jsx("div",{className:"text-center",children:e.jsx($,{})}):e.jsxs(xe,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(Ce,{children:e.jsxs(q,{children:[e.jsx(i,{children:"Request ID"}),e.jsx(i,{children:"Department"}),e.jsx(i,{children:"Type"}),e.jsx(i,{children:"Category"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Date"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(je,{children:S&&S.length>0?S.map(s=>e.jsxs(q,{children:[e.jsx(o,{children:s.requestId}),e.jsx(o,{children:s.department}),e.jsx(o,{children:s.typeOfRequest}),e.jsx(o,{children:s.category}),e.jsxs(o,{children:["$",parseFloat(s.totalRequest).toFixed(2)]}),e.jsx(o,{children:e.jsx(ne,{color:ae(s.status),children:s.status})}),e.jsx(o,{children:ce(s.createdAt)}),e.jsx(o,{children:e.jsxs(ie,{children:[e.jsx(le,{color:"secondary",size:"sm",children:"Actions"}),e.jsxs(de,{children:[e.jsxs(y,{onClick:()=>ee(`/budget-requests/${s._id}`),children:[e.jsx(p,{icon:De,className:"me-2"})," View Details"]}),s.status==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:()=>re(s),children:[e.jsx(p,{icon:Te,className:"me-2"})," Edit"]}),e.jsxs(y,{onClick:()=>O(s._id,"Approved"),children:[e.jsx(p,{icon:qe,className:"me-2"})," Approve"]}),e.jsxs(y,{onClick:()=>O(s._id,"Declined"),children:[e.jsx(p,{icon:Me,className:"me-2"})," Decline"]})]}),e.jsxs(y,{onClick:()=>te(s._id),children:[e.jsx(p,{icon:Ae,className:"me-2"})," Archive"]})]})]})})]},s._id)):e.jsx(q,{children:e.jsx(o,{colSpan:"8",className:"text-center",children:"No budget requests found"})})})]})]})]})}),e.jsxs(fe,{visible:U,onClose:()=>C(!1),size:"lg",children:[e.jsx(ye,{closeButton:!0,children:e.jsx(ge,{children:v==="create"?"Create New Budget Request":"Edit Budget Request"})}),e.jsx(ve,{children:e.jsxs(Re,{onSubmit:k,children:[e.jsxs(h,{className:"mb-3",children:[e.jsxs(n,{md:6,children:[e.jsx(m,{children:"Department"}),e.jsxs(D,{name:"department",value:a.department,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),X.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs(n,{md:6,children:[e.jsx(m,{children:"Type of Request"}),e.jsxs(D,{name:"typeOfRequest",value:a.typeOfRequest,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),W.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),e.jsxs(h,{className:"mb-3",children:[e.jsxs(n,{md:6,children:[e.jsx(m,{children:"Category"}),e.jsxs(D,{name:"category",value:a.category,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),K.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs(n,{md:6,children:[e.jsx(m,{children:"Total Amount Requested"}),e.jsxs(Se,{children:[e.jsx(be,{children:"$"}),e.jsx(_,{type:"number",name:"totalRequest",value:a.totalRequest,onChange:u,min:"0",step:"0.01",required:!0})]})]})]}),e.jsx(h,{className:"mb-3",children:e.jsxs(n,{children:[e.jsx(m,{children:"Reason for Request"}),e.jsx(z,{name:"reason",value:a.reason,onChange:u,rows:3,required:!0})]})}),e.jsx(h,{className:"mb-3",children:e.jsxs(n,{children:[e.jsx(m,{children:"Supporting Documents"}),e.jsx(_,{type:"file",onChange:se,accept:".pdf,.doc,.docx,.jpg,.png"}),((V=j==null?void 0:j.documents)==null?void 0:V.length)>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:["Current document: ",j.documents[0]]})})]})}),v==="edit"&&e.jsx(h,{className:"mb-3",children:e.jsxs(n,{children:[e.jsx(m,{children:"Comment"}),e.jsx(z,{name:"comment",value:a.comment,onChange:u,rows:2})]})})]})}),e.jsxs(we,{children:[e.jsx(w,{color:"secondary",onClick:()=>C(!1),children:"Cancel"}),e.jsx(w,{color:"primary",onClick:k,disabled:P,children:P?e.jsx($,{size:"sm"}):v==="create"?"Submit Request":"Update Request"})]})]})]})};export{Ke as default};
