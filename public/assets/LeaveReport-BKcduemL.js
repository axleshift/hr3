import{r as o,j as e,C as U,R as _,m as h}from"./index-DDbZvJeW.js";import{a as C,F as w,E as B,c as $}from"./index-L_MtF71K.js";import{C as A,a as I}from"./CCardBody-Co8lq37Q.js";import{C as q}from"./CCardHeader-B_dnQ4Fk.js";import{C as y}from"./CFormSelect-B1-ZEqTM.js";import{C as H}from"./CAlert-DdC9cvg9.js";import{C as Y,a as M,b as p,c as n,d as O,e as r}from"./CTable-D4MvuC7h.js";import{C as u}from"./DefaultLayout-BE_0No5-.js";import"./CFormControlWrapper-Dd6j17pB.js";const te=()=>{const[g,b]=o.useState([]),[V,N]=o.useState([]),[c,D]=o.useState(new Date().getFullYear()),[l,v]=o.useState(new Date().getMonth()+1),[j,x]=o.useState(!1),[f,m]=o.useState(null),S=Array.from({length:new Date().getFullYear()-2020+1},(t,s)=>2020+s),R=async()=>{try{x(!0),m(null);const t=c&&l?{year:c,month:l}:{},[s,a]=await Promise.all([h.get("/leave-requests/page",{params:t}),h.get("/leave-types")]);b(s.data.leaveRequests||s.data),N(a.data)}catch(t){m("Error fetching leave data."),console.error(t)}finally{x(!1)}};o.useEffect(()=>{R()},[c,l]);const L=t=>t.reduce((s,a)=>{const d=a.department||"Unassigned";return s[d]||(s[d]=[]),s[d].push(a),s},{}),F=async()=>{try{x(!0),m(null);const t=`${l}/${c}`,s={year:c,month:l,password:t},a=await h.get("/generate-report",{params:s,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([a.data])),i=document.createElement("a");i.href=d,i.setAttribute("download",`leave-report-${c}-${l}.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(d)}catch(t){m("Error generating PDF report."),console.error(t)}finally{x(!1)}},P=()=>{const t=`${l}/${c}`,s={year:c,month:l,password:t};window.open(`${h.defaults.baseURL}/view-report?${new URLSearchParams(s).toString()}`,"_blank")},k=t=>{let s;switch(t){case"Approved":s="success";break;case"Rejected":s="danger";break;default:s="warning"}return e.jsx(u,{color:s,children:t})},T=t=>t==="Paid"?e.jsx(u,{color:"success",children:"Paid"}):e.jsx(u,{color:"secondary",children:"Unpaid"}),E={fontWeight:"bold",fontSize:"1.1em",padding:"10px",backgroundColor:"#f0f0f0"};return e.jsx("div",{children:e.jsxs(A,{className:"mb-4",children:[e.jsxs(q,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Leave Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(y,{value:l,onChange:t=>v(parseInt(t.target.value)),style:{width:"120px"},children:Array.from({length:12},(t,s)=>{const a=s+1;return e.jsx("option",{value:a,children:new Date(2e3,s).toLocaleString("default",{month:"long"})},a)})}),e.jsx(y,{value:c,onChange:t=>D(parseInt(t.target.value)),style:{width:"90px"},children:S.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs(C,{color:"danger",onClick:F,disabled:j,children:[e.jsx(w,{icon:B})," Export PDF"]}),e.jsxs(C,{color:"info",onClick:P,className:"ms-2",disabled:j,children:[e.jsx(w,{icon:$})," View PDF"]})]})]}),e.jsxs(I,{children:[f&&e.jsx(H,{color:"danger",children:f}),j?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(U,{color:"primary"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(Y,{striped:!0,bordered:!0,responsive:!0,children:[e.jsx(M,{children:e.jsxs(p,{children:[e.jsx(n,{className:"text-center",children:"ID"}),e.jsx(n,{children:"Name"}),e.jsx(n,{className:"text-center",children:"Department"}),e.jsx(n,{className:"text-center",children:"Job Position"}),e.jsx(n,{className:"text-center",children:"Leave Type"}),e.jsx(n,{className:"text-center",children:"Duration"}),e.jsx(n,{className:"text-center",children:"Days"}),e.jsx(n,{className:"text-center",children:"Reason"}),e.jsx(n,{className:"text-center",children:"Paid"}),e.jsx(n,{className:"text-center",children:"Status"})]})}),e.jsx(O,{children:g.length>0?Object.entries(L(g)).map(([t,s])=>e.jsxs(_.Fragment,{children:[e.jsx(p,{children:e.jsx(r,{colSpan:"10",style:E,children:e.jsxs("strong",{children:[t," Department"]})})}),s.map(a=>e.jsxs(p,{children:[e.jsx(r,{children:a.id}),e.jsx(r,{children:a.name}),e.jsx(r,{className:"text-center",children:a.department||"Unassigned"}),e.jsx(r,{className:"text-center",children:a.job_position}),e.jsx(r,{className:"text-center",children:a.leave_type}),e.jsxs(r,{className:"text-center",children:[new Date(a.start_date).toLocaleDateString()," -"," ",new Date(a.end_date).toLocaleDateString()]}),e.jsx(r,{className:"text-center",children:a.total_days}),e.jsx(r,{className:"text-center",children:a.reason}),e.jsx(r,{className:"text-center",children:T(a.is_paid)}),e.jsx(r,{className:"text-center",children:k(a.status)})]},a.id))]},t)):e.jsx(p,{children:e.jsx(r,{colSpan:"10",className:"text-center",children:"No leave data available for the selected period"})})})]})})})]})]})})};export{te as default};
