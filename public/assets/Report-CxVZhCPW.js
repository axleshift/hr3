import{r as d,j as e,C as S,R as A,m as v}from"./index-CbFWoaI5.js";import{a as D,F,B,D as U}from"./index-BoNXW8A9.js";import{C as H,a as O}from"./CCardBody-Fxq8QZEm.js";import{C as I}from"./CCardHeader-CdD6i7wQ.js";import{C as N}from"./CFormSelect-CgMgLtRD.js";import{C as Y}from"./CAlert-C06U3ob5.js";import{C as $,a as M,b as c,c as l,d as z,e as n,f as W}from"./CTable-BEmur1Om.js";import"./CFormControlWrapper-UpGAhbY9.js";const ee=()=>{const[i,f]=d.useState([]),[x,T]=d.useState(new Date().getFullYear()),[p,P]=d.useState(new Date().getMonth()+1),[h,g]=d.useState(!1),[m,j]=d.useState(null),[y,C]=d.useState(!1),E=Array.from({length:new Date().getFullYear()-2020+1},(r,a)=>2020+a),b=async()=>{var r,a;try{g(!0),j(null);const s=await v.get("/api/payrolls",{params:{year:x,month:p},withCredentials:!0}),t=s.data.payroll||s.data;if(Array.isArray(t))f(t);else throw new Error("Invalid payroll data format received from server")}catch(s){console.error("Error fetching payroll data:",s),j(((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||s.message||"Failed to fetch payroll data"),f([])}finally{g(!1)}};d.useEffect(()=>{b()},[x,p]);const L=()=>i.reduce((r,a)=>r+parseFloat(a.net_salary||0),0),o=r=>parseFloat(r||0).toLocaleString("en-US",{style:"currency",currency:"PHP",minimumFractionDigits:2}),w=r=>r.reduce((a,s)=>{const t=s.department||"Unassigned";return a[t]||(a[t]=[]),a[t].push(s),a},{}),R=async()=>{try{C(!0);const r=await v.get("/api/payroll/download-report",{params:{year:x,month:p},responseType:"blob",withCredentials:!0}),a=window.URL.createObjectURL(new Blob([r.data])),s=document.createElement("a");s.href=a,s.setAttribute("download",`payroll-report-${x}-${p}.pdf`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(r){console.error("Error downloading PDF:",r),j("Failed to download the PDF. Please try again.")}finally{C(!1)}},_={backgroundColor:"#f8f9fa",fontWeight:"bold",fontSize:"1.1em",padding:"10px"},k={backgroundColor:"#e9ecef",fontWeight:"bold"};return e.jsx("div",{children:e.jsxs(H,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("strong",{children:"Payroll Report"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsx(N,{value:p,onChange:r=>P(parseInt(r.target.value)),style:{width:"120px"},disabled:h,children:Array.from({length:12},(r,a)=>e.jsx("option",{value:a+1,children:new Date(2023,a).toLocaleString("default",{month:"long"})},a+1))}),e.jsx(N,{value:x,onChange:r=>T(parseInt(r.target.value)),style:{width:"90px"},disabled:h,children:E.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx(D,{color:"secondary",onClick:b,disabled:h,children:e.jsx(F,{icon:B,spin:h})}),e.jsx(D,{color:"primary",onClick:R,disabled:y||h||i.length===0,children:y?e.jsx(S,{size:"sm"}):e.jsx(F,{icon:U})})]})]}),e.jsxs(O,{children:[m&&e.jsx(Y,{color:"danger",dismissible:!0,onClose:()=>j(null),children:m}),h?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(S,{}),e.jsx("p",{children:"Loading payroll data..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs($,{hover:!0,bordered:!0,responsive:!0,children:[e.jsx(M,{children:e.jsxs(c,{children:[e.jsx(l,{children:"Employee Name"}),e.jsx(l,{children:"Department"}),e.jsx(l,{children:"Base Salary"}),e.jsx(l,{children:"Overtime"}),e.jsx(l,{children:"Bonus"}),e.jsx(l,{children:"Benefits"}),e.jsx(l,{children:"Deductions"}),e.jsx(l,{children:"Net Salary"})]})}),e.jsx(z,{children:i.length>0?Object.entries(w(i)).map(([r,a],s)=>e.jsxs(A.Fragment,{children:[e.jsx(c,{children:e.jsx(n,{colSpan:"8",style:_,children:r})}),a.map((t,u)=>e.jsxs(c,{children:[e.jsx(n,{children:t.name||"N/A"}),e.jsx(n,{children:t.department||"N/A"}),e.jsx(n,{children:o(t.base_salary)}),e.jsx(n,{children:o(t.total_overtime_amount)}),e.jsx(n,{children:o(t.bonus)}),e.jsx(n,{children:o(t.benefits_total)}),e.jsx(n,{children:o(t.total_deductions||t.tax)}),e.jsx(n,{children:o(t.net_salary)})]},`${t.id}-${u}`)),e.jsxs(c,{style:k,children:[e.jsx(n,{colSpan:"6",className:"text-center",children:e.jsx("strong",{children:"Department Total"})}),e.jsx(n,{colSpan:"2",children:e.jsx("strong",{children:o(a.reduce((t,u)=>t+parseFloat(u.net_salary||0),0))})})]}),s<Object.keys(w(i)).length-1&&e.jsx(c,{children:e.jsx(n,{colSpan:"8",style:{padding:"10px 0"},children:e.jsx("hr",{style:{borderTop:"2px solid #ddd"}})})})]},r)):e.jsx(c,{children:e.jsx(n,{colSpan:"8",className:"text-center py-4",children:m?"Error loading data":"No payroll data available for selected period"})})}),i.length>0&&e.jsx(W,{children:e.jsxs(c,{style:{backgroundColor:"#dee2e6"},children:[e.jsx(l,{colSpan:"6",className:"text-center",children:e.jsx("strong",{children:"Grand Total"})}),e.jsx(l,{colSpan:"2",className:"text-center",children:e.jsx("strong",{children:o(L())})})]})})]})})]})]})})};export{ee as default};
